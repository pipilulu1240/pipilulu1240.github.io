<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¤§æŸ´å°ç†Šå¯µç‰©ç¾å®¹ | å°ˆæ¥­ç¾å®¹ãƒ»å®‰è¦ªä½å®¿</title>
    
<link rel="icon" href="https://vmjczgepqlefbsfarogk.supabase.co/storage/v1/object/public/logo/logo__2_-removebg-preview.png" type="image/png">    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@300;400;500;700;900&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.1/dist/umd/supabase.js"></script>

    <script>
        const themeColors = {
            primary: '#A5C4AE',   // Logo çš„åº•è‰² (æŠ¹èŒ¶ç¶ /é¼ å°¾è‰ç¶ )
            dark: '#769A82',      // æ¼¸å±¤ç”¨çš„æ·±ç¶ è‰²
            text: '#4A5D50',      // æ·±å¢¨ç¶ è‰²æ–‡å­— (æ¯”ç´”é»‘æ›´æœ‰è³ªæ„Ÿ)
            bg: '#F5F9F6'         // æ¥µæ·¡çš„ç¶ ç™½è‰²èƒŒæ™¯
        };

        tailwind.config = { 
            theme: {
                extend: {
                    colors: {
                        theme: {
                            bg: themeColors.bg,
                            primary: themeColors.primary,
                            dark: themeColors.dark,
                            text: themeColors.text,
                            sub: '#8C9E92',
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'],
                        en: ['"Cormorant Garamond"', 'serif'],
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(74, 93, 80, 0.08)',
                        'glow': `0 0 20px ${themeColors.primary}60`,
                    },
                    backgroundImage: {
                        // ç²¾å“ç¶ è‰²æ¼¸å±¤ (æŒ‰éˆ•èˆ‡è£é£¾ç”¨)
                        'gradient-lux': `linear-gradient(135deg, ${themeColors.primary} 0%, ${themeColors.dark} 100%)`,
                        // ä½å®¿æŒ‰éˆ•ç”¨çš„æ¼¸å±¤ (ç¨å¾®æ·ºä¸€é»å€åˆ†)
                        'gradient-light': `linear-gradient(135deg, ${themeColors.dark} 0%, #B8D6C0 100%)`,
                        'shimmer': 'linear-gradient(45deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 60%)',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'float': 'float 4s ease-in-out infinite',
                        'shimmer': 'shimmer 2.5s infinite',
                    },
                    keyframes: {
                        slideUp: { from: { opacity: '0', transform: 'translateY(40px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-8px)' } },
                        shimmer: { '0%': { backgroundPosition: '-200% center' }, '100%': { backgroundPosition: '200% center' } },
                    }
                }
            }
        }
    </script>

<style>
        body { 
            background-color: #F5F9F6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(165, 196, 174, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(118, 154, 130, 0.15) 0%, transparent 40%);
            font-family: 'Noto Serif TC', serif;
            color: #4A5D50;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* âœ… é˜²æ­¢ iPhone é»è¼¸å…¥æ¡†æ”¾å¤§ */
        input, textarea, select {
            font-size: 16px !important;
        }
        
        .font-en { font-family: 'Cormorant Garamond', serif; }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8); 
            box-shadow: 0 8px 32px 0 rgba(74, 93, 80, 0.08);
        }

        .btn-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .btn-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-4px);
            border-color: #A5C4AE;
        }
        .btn-card:active { transform: scale(0.96); }

        .text-gradient {
            background: linear-gradient(135deg, #4A5D50 30%, #769A82 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
</style>
</head>

<body class="min-h-screen relative flex flex-col">

    <nav class="fixed top-0 w-full z-50 transition-all duration-500 opacity-0 pointer-events-none" id="navbar">
        <div class="bg-white/80 backdrop-blur-xl border-b border-white/40 shadow-sm">
            <div class="px-6 py-4 flex justify-between items-center max-w-lg mx-auto">
                <div class="flex items-center gap-3" onclick="router('home')">
                    <div class="w-9 h-9 rounded-full bg-theme-bg border border-theme-primary/30 flex items-center justify-center overflow-hidden">
<img src="https://vmjczgepqlefbsfarogk.supabase.co/storage/v1/object/public/logo/logo__2_-removebg-preview.png" class="w-full h-full object-contain">
                    </div>
                    <span class="font-bold text-lg tracking-widest text-theme-text font-serif">å¤§æŸ´å°ç†Š</span>
                </div>
                <button onclick="router('home')" class="flex items-center gap-1.5 text-xs font-bold text-theme-sub uppercase border border-transparent hover:border-theme-primary/30 px-3 py-1.5 rounded-full transition-colors">
                    <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i> Back
                </button>
            </div>
        </div>
    </nav>

<main class="flex-1 w-full max-w-lg md:max-w-2xl mx-auto relative z-10 flex flex-col py-6 px-6">

        <div id="view-home" class="flex flex-col justify-center min-h-[90vh] py-8">
            
            <div class="w-full glass-panel rounded-[32px] p-8 text-center relative overflow-hidden animate-slide-up z-20 mb-6 group">
                <div class="absolute -top-24 -right-24 w-64 h-64 bg-theme-primary/20 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-theme-dark/10 rounded-full blur-3xl"></div>

                <div class="relative z-10 mb-6 flex justify-center">
<div id="home-logo" class="w-44 h-44 rounded-full p-2 bg-gradient-to-br from-white/90 to-white/40 shadow-xl border border-white flex items-center justify-center animate-float ring-1 ring-white/60 cursor-pointer">
                        <div class="w-full h-full rounded-full overflow-hidden bg-white flex items-center justify-center relative shadow-inner">
<img src="https://vmjczgepqlefbsfarogk.supabase.co/storage/v1/object/public/logo/logo__2_-removebg-preview.png" alt="Logo" class="w-full h-full object-contain">
                        </div>
                    </div>
                </div>

                <div class="relative z-10 space-y-2 mb-8">
                    <h1 class="text-3xl font-black tracking-[0.2em] leading-tight text-gradient font-serif">
                        å¤§æŸ´å°ç†Š
                    </h1>
                    <span class="text-lg font-bold text-theme-dark tracking-[0.1em] block">
                        ç¾å®¹ã€ä½å®¿ã€å®‰è¦ª 
                    </span>
                    <div class="flex items-center justify-center gap-2 mt-2 opacity-70">
                        <span class="h-px w-6 bg-theme-sub/50"></span>
                        <p class="text-[10px] text-theme-sub tracking-[0.15em] font-medium font-en">
                            Professional Pet Grooming
                        </p>
                        <span class="h-px w-6 bg-theme-sub/50"></span>
                    </div>
                    <p class="text-[10px] text-theme-sub/60 tracking-widest mt-1">
                        ç‰¹å¯µæ¥­å­—ç¬¬ S1130033 è™Ÿ
                    </p>
                </div>

                <div class="relative z-10 grid gap-4">
                    
                    <button onclick="router('form', 'grooming')" class="group relative w-full overflow-hidden rounded-xl shadow-lg hover:shadow-glow hover:-translate-y-1 transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-lux opacity-90 group-hover:opacity-100 transition"></div>
                        <div class="absolute inset-0 bg-shimmer bg-[length:200%_100%] animate-shimmer opacity-30"></div>
                        <div class="relative py-5 px-6 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm border border-white/20">
                                    <i data-lucide="scissors" class="w-5 h-5 text-white"></i>
                                </div>
                                <div class="text-left text-white">
                                    <span class="block font-bold text-lg tracking-[0.2em] font-serif">å¯µç‰©ç¾å®¹</span>
                                    <span class="block text-[10px] opacity-90 tracking-wider font-en">Pet Grooming</span>
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-white/80 group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </button>

                    <button onclick="router('form', 'boarding')" class="group relative w-full overflow-hidden rounded-xl shadow-lg hover:shadow-glow hover:-translate-y-1 transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-light opacity-90 group-hover:opacity-100 transition"></div>
                        <div class="absolute inset-0 bg-shimmer bg-[length:200%_100%] animate-shimmer opacity-30"></div>
                        <div class="relative py-5 px-6 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm border border-white/20">
                                    <i data-lucide="home" class="w-5 h-5 text-white"></i>
                                </div>
                                <div class="text-left text-white">
                                    <span class="block font-bold text-lg tracking-[0.2em] font-serif">å¯µç‰©ä½å®¿</span>
                                    <span class="block text-[10px] opacity-90 tracking-wider font-en">Pet Boarding</span>
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-white/80 group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </button>

                </div>
            </div>

            <div class="w-full space-y-3 animate-slide-up" style="animation-delay: 0.15s; opacity: 0; animation-fill-mode: forwards;">
                
<a href="https://lin.ee/DguRzCU" target="_blank" class="btn-card flex items-center p-4 rounded-2xl group hover:border-[#06C755]/50">
                    <div class="w-10 h-10 rounded-full bg-[#06C755]/10 text-[#06C755] flex items-center justify-center mr-4 group-hover:bg-[#06C755] group-hover:text-white transition-colors duration-300">
                        <svg viewBox="0 0 256 256" class="w-5 h-5" fill="currentColor">
                            <g transform="translate(1.4 1.4) scale(2.81)">
                                <path d="M 42.685 88.018 c -0.944 0 -1.935 -0.233 -2.809 -0.929 c -2.075 -1.653 -1.61 -4.302 -1.435 -5.299 l 0.015 -0.085 c 0.097 -0.573 0.523 -3.138 0.589 -3.532 c 0.143 -1.106 0.122 -1.725 0.087 -2.032 c -0.248 -0.131 -0.736 -0.332 -1.527 -0.51 C 15.806 72.699 0 57.334 0 39.057 C 0 18.615 20.187 1.984 45 1.984 c 24.813 0 45 16.631 45 37.073 c 0 6.388 -1.921 12.34 -5.848 18.055 h 0.347 l -2.727 3.14 c -0.471 0.568 -0.964 1.135 -1.476 1.7 l -0.03 0.034 c -9.005 10.364 -29.164 23.109 -34.124 25.199 C 45.535 87.442 44.169 88.018 42.685 88.018 z M 45 7.872 c -21.566 0 -39.112 13.99 -39.112 31.185 c 0 15.321 13.716 28.255 32.614 30.754 l 0.234 0.04 c 3.099 0.668 5.056 1.964 5.817 3.853 c 0.524 1.311 0.625 2.988 0.324 5.285 l -0.015 0.099 c 0 0 -0.221 1.327 -0.399 2.397 c 5.106 -2.446 21.464 -12.945 29.972 -21.843 l 1.432 -1.571 c 5.626 -6.17 8.246 -12.212 8.246 -19.015 C 84.112 21.862 66.566 7.872 45 7.872 z"/>
                                <path d="M 37.309 31.467 h -2.655 c -0.407 0 -0.737 0.33 -0.737 0.736 v 16.492 c 0 0.406 0.33 0.735 0.737 0.735 h 2.655 c 0.407 0 0.737 -0.329 0.737 -0.735 V 32.203 C 38.047 31.797 37.716 31.467 37.309 31.467"/>
                                <path d="M 55.584 31.467 h -2.655 c -0.407 0 -0.737 0.33 -0.737 0.736 v 9.798 l -7.558 -10.207 c -0.017 -0.026 -0.037 -0.051 -0.057 -0.075 h -2.655 c -0.407 0 -0.737 0.33 -0.737 0.736 v 16.492 c 0 0.406 0.33 0.735 0.737 0.735 h 2.655 v -10.59 l 7.567 10.22 c 0.052 0.073 0.117 0.134 0.187 0.182 h 2.655 c 0.407 0 0.737 -0.329 0.737 -0.735 V 32.203 C 56.321 31.797 55.991 31.467 55.584 31.467"/>
                                <path d="M 30.91 45.302 h -7.214 V 32.204 c 0 -0.407 -0.33 -0.737 -0.737 -0.737 h -2.655 c -0.407 0 -0.737 0.33 -0.737 0.737 v 16.491 c 0 0.407 0.33 0.737 0.737 0.737 H 30.91 c 0.407 0 0.736 -0.33 0.736 -0.737 v -2.655 C 31.646 45.632 31.316 45.302 30.91 45.302"/>
                                <path d="M 70.245 35.597 c 0.407 0 0.736 -0.33 0.736 -0.737 v -2.655 c 0 -0.407 -0.329 -0.738 -0.736 -0.738 H 59.639 v 16.489 c 0 0.407 0.33 0.737 0.737 0.737 h 10.606 c 0.407 0 0.736 -0.33 0.736 -0.737 v -2.655 c 0 -0.407 -0.329 -0.737 -0.736 -0.737 h -7.213 v -2.788 h 7.213 c 0.407 0 0.736 -0.33 0.736 -0.737 v -2.655 c 0 -0.407 -0.329 -0.738 -0.736 -0.738 h -7.213 v -2.787 H 70.245 z"/>
                            </g>
                        </svg>
                    </div>
                    <div class="flex-1">
                         <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-0.5">Online Booking</span>
                         <span class="block text-sm font-bold text-theme-text group-hover:text-[#06C755] transition-colors">åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿ</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 text-theme-sub/50 group-hover:text-[#06C755]"></i>
                </a>
                
                <a href="https://www.instagram.com/chenpichenlu_pet.grooming/" target="_blank" class="btn-card flex items-center p-4 rounded-2xl group hover:border-[#E1306C]/50">
                     <div class="w-10 h-10 rounded-full bg-[#E1306C]/10 text-[#E1306C] flex items-center justify-center mr-4 group-hover:bg-[#E1306C] group-hover:text-white transition-colors duration-300">
                        <i data-lucide="instagram" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                         <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-0.5">Instagram</span>
                         <span class="block text-sm font-bold text-theme-text group-hover:text-[#E1306C] transition-colors">è¿½è¹¤æˆ‘å€‘ @chenpichenlu</span>
                    </div>
                    <i data-lucide="arrow-up-right" class="w-4 h-4 text-theme-sub/50 group-hover:text-[#E1306C]"></i>
                </a>

<a href="https://maps.app.goo.gl/ZX632JTbHmaxbyLN7" target="_blank" class="btn-card flex items-center p-4 rounded-2xl group hover:border-theme-primary/50">
                     <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center mr-4 group-hover:bg-theme-primary group-hover:text-white transition-colors">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                         <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-0.5">Location</span>
                         <span class="block text-sm font-bold text-theme-text group-hover:text-theme-dark transition-colors">å°ä¸­å¸‚åŒ—å±¯å€å¹³å¾·è·¯82å··5è™Ÿ 1æ¨“</span>
                    </div>
                    <i data-lucide="arrow-up-right" class="w-4 h-4 text-theme-sub/50 group-hover:text-theme-dark"></i>
                </a>

                <div class="grid grid-cols-2 gap-3">
                    <a href="tel:0981681349" class="btn-card p-4 flex flex-col items-center justify-center gap-3 rounded-2xl group hover:border-theme-primary/50">
                        <div class="w-10 h-10 rounded-full bg-theme-primary/10 text-theme-primary flex items-center justify-center group-hover:bg-theme-primary group-hover:text-white transition-colors duration-300">
                            <i data-lucide="phone-call" class="w-5 h-5"></i>
                        </div>
                        <div class="text-center">
                            <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-1">é ç´„é›»è©±</span>
                            <span class="block text-sm font-bold text-theme-text font-en tracking-wider">0981-681-349</span>
                        </div>
                    </a>

                    <div class="btn-card p-4 flex flex-col items-center justify-center gap-3 rounded-2xl cursor-default hover:border-theme-primary/50">
                        <div class="w-10 h-10 rounded-full bg-theme-dark/10 text-theme-dark flex items-center justify-center">
                            <i data-lucide="clock-3" class="w-5 h-5"></i>
                        </div>
                        <div class="text-center">
                            <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-1">ç‡Ÿæ¥­æ™‚é–“</span>
                            <span class="block text-sm font-bold text-theme-text font-en tracking-wider">10:00 â€“ 19:00</span>
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center space-y-1">
                    <p class="text-[10px] text-theme-sub/60">è² è²¬äººï¼šé™³äºçª | çµ±ç·¨ï¼š94536765</p>
                    <p class="text-[10px] text-theme-sub/60">Â© 2026 å¤§æŸ´å°ç†Šå¯µç‰©ç¾å®¹ All Rights Reserved.</p>
                </div>

            </div>
        </div>

<div id="view-form" class="hidden pb-20 pt-20">
            <header class="text-center mb-10 space-y-2 animate-fade-in">
                <span id="form-subtitle" class="text-xs font-bold text-theme-dark tracking-[0.3em] uppercase block mb-2 font-en">Service Agreement</span>
                <h2 id="form-title" class="text-2xl font-black text-theme-text tracking-[0.2em] font-serif">å¯µç‰©ç¾å®¹å¥‘ç´„æ›¸</h2>
                <div class="flex items-center justify-center gap-2 text-theme-sub/60 mt-3">
                    <span class="h-px w-8 bg-theme-sub/30"></span>
                    <i id="form-icon" data-lucide="scissors" class="w-3 h-3 text-theme-primary"></i>
                    <span class="h-px w-8 bg-theme-sub/30"></span>
                </div>
            </header>
<div class="glass-panel p-6 rounded-2xl mb-6 text-center animate-slide-up">
                <img src="line.png" class="w-14 h-14 mx-auto mb-3 object-contain">
                <h3 class="text-theme-text font-bold text-lg mb-1">åŠ å…¥å®˜æ–¹ LINE</h3>
                <p class="text-theme-sub font-en tracking-wider text-sm mb-4">ID: @923hnkxg</p>
                
                <div class="space-y-3">
                    <a href="https://line.me/R/ti/p/%40923hnkxg" target="_blank" class="block w-full bg-[#06C755] text-white py-3 rounded-xl font-bold shadow-lg shadow-[#06C755]/20 hover:scale-[1.02] transition-transform">
                        1. é»æ“ŠåŠ å…¥å¥½å‹
                    </a>
                    <div class="flex items-center justify-center gap-2 text-red-500 font-bold text-sm bg-red-50 py-2 rounded-lg border border-red-100">
                        <i data-lucide="alert-circle" class="w-4 h-4"></i>
                        2. å‹™å¿…å‚³é€è²¼åœ–
                    </div>
                </div>
            </div>

<form id="main-form" class="space-y-5 animate-slide-up" style="animation-delay: 0.1s;">
                
                <div class="glass-panel p-6 rounded-2xl relative">
                    <div class="flex items-center gap-2 mb-6 border-b border-theme-sub/20 pb-3">
                        <span class="text-2xl">ğŸ‘¤</span>
                        <h3 class="font-bold text-theme-text text-lg">é£¼ä¸»åŸºæœ¬è³‡æ–™</h3>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">é›»å­éƒµä»¶ (é¸å¡«)</label>
<input type="email" id="email"
       autocomplete="email"
       class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary focus:ring-1 focus:ring-theme-primary transition"
       placeholder="example@email.com">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">ä¸»äººå§“å*</label>
<input type="text" id="owner_name"
       autocomplete="name"
       class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition"
       required>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">é€£çµ¡é›»è©±*</label>
                            <div class="flex gap-2">
<input type="tel" id="phone"
       autocomplete="tel"
       class="flex-1 w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition"
       placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼"
       required
       inputmode="numeric"
       maxlength="10"
       pattern="^09\d{8}$"
       data-error="é€£çµ¡é›»è©±æ ¼å¼éŒ¯èª¤ï¼Œéœ€ç‚º 09 é–‹é ­ 10 ç¢¼"
       oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)">
                                <button type="button" onclick="searchOldCustomer()" class="bg-theme-dark/10 text-theme-dark px-4 rounded-xl font-bold text-sm hover:bg-theme-dark hover:text-white transition whitespace-nowrap flex items-center gap-1">
                                    <i data-lucide="search" class="w-4 h-4"></i>
                                    èˆŠå®¢
                                </button>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">èº«åˆ†è­‰å­—è™Ÿ*</label>
<input type="text" id="id_number"
       class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition"
       required
       maxlength="10"
pattern="^[A-Za-z][12][0-9]{8}$"
  data-error="èº«åˆ†è­‰æ ¼å¼éŒ¯èª¤ï¼ˆ1å€‹è‹±æ–‡ + 1æˆ–2 + 8ä½æ•¸å­—ï¼‰"

       oninput="this.value=this.value.toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,10)">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">é€šè¨Šåœ°å€*</label>
                            <input type="text" id="address" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" required>
                        </div>

                        <div class="grid grid-cols-2 gap-3 pt-2">
                            <div>
                                <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">ç·Šæ€¥è¯çµ¡äºº*</label>
                                <input type="text" id="emergency_contact" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" required>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">ç·Šæ€¥é›»è©±*</label>
<input type="tel" id="emergency_phone"
       class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition"
       required
       inputmode="numeric"
       maxlength="10"
       pattern="^09\d{8}$"
       oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel p-6 rounded-2xl relative">
                    <div class="flex items-center gap-2 mb-6 border-b border-theme-sub/20 pb-3">
                        <span class="text-2xl">ğŸ¾</span>
                        <h3 class="font-bold text-theme-text text-lg">å¯µç‰©è©³ç´°è³‡æ–™</h3>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">ç¨®é¡*</label>
                            <div class="flex gap-3">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer hover:border-theme-primary/50 transition has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="pet_type" value="ç‹—ç‹—" class="sr-only" checked>
                                    <span class="text-lg">ğŸ¶</span>
                                    <span class="text-sm font-bold text-theme-text">ç‹—ç‹—</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer hover:border-theme-primary/50 transition has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="pet_type" value="è²“å’ª" class="sr-only">
                                    <span class="text-lg">ğŸ±</span>
                                    <span class="text-sm font-bold text-theme-text">è²“å’ª</span>
                                </label>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
<div>
    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">å¯µç‰©åå­—*</label>
    <input type="text" id="pet_name" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" required>
</div>
<div>
    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">å“ç¨®*</label>
    <input type="text" id="pet_breed" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" required>
</div>
</div> 
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">é«”é‡ (kg)*</label>
<input type="number" id="pet_weight" step="0.1" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" required>
                            </div>
<div>
                                <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">ç”Ÿæ—¥ / å¹´é½¡*</label>
                                <div class="flex bg-theme-sub/10 p-1 rounded-xl mb-2">
                                    <button type="button" onclick="toggleAgeInput('birthday')" id="tab-birthday" class="flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all bg-white text-theme-primary shadow-sm">ç”Ÿæ—¥</button>
                                    <button type="button" onclick="toggleAgeInput('age')" id="tab-age" class="flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all text-theme-sub">å¹´é½¡</button>
                                </div>
                                <div id="input-birthday" class="animate-fade-in">
<input type="date" id="pet_birthday" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                                </div>
                                <div id="input-age" class="hidden animate-fade-in">
                                    <div class="relative">
<input type="number" id="pet_age" step="1" min="0" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" placeholder="è«‹è¼¸å…¥å¹´é½¡">
                                        <span class="absolute right-4 top-1/2 -translate-y-1/2 text-sm text-theme-sub font-bold">æ­²</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ€§åˆ¥*</label>
                                <div class="flex gap-2">
                                    <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300 has-[:checked]:text-blue-600 transition">
<input type="radio" name="gender" value="å…¬" class="sr-only">
                                        <span class="text-sm font-bold">å…¬</span>
                                    </label>
                                    <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-pink-50 has-[:checked]:border-pink-300 has-[:checked]:text-pink-600 transition">
                                        <input type="radio" name="gender" value="æ¯" class="sr-only">
                                        <span class="text-sm font-bold">æ¯</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">çµç´®*</label>
                                <div class="flex gap-2">
                                    <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                                        <input type="radio" name="neuter" value="å·²çµç´®" class="sr-only">
                                        <span class="text-sm font-bold">æ˜¯</span>
                                    </label>
                                    <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                                        <input type="radio" name="neuter" value="æœªçµç´®" class="sr-only">
                                        <span class="text-sm font-bold">å¦</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ™¶ç‰‡ç‹€æ…‹*</label>
                            <div class="flex flex-wrap gap-2 mb-3">
                                <label class="flex-1 min-w-[30%] bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                                    <input type="radio" name="microchip_status" value="æœ‰æ™¶ç‰‡" class="sr-only" onchange="document.getElementById('chip-number-input').classList.remove('hidden')">
                                    <span class="text-sm font-bold">æœ‰æ™¶ç‰‡</span>
                                </label>
                                <label class="flex-1 min-w-[30%] bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                                    <input type="radio" name="microchip_status" value="æœ‰æ™¶ç‰‡è™Ÿç¢¼ä¸è©³" class="sr-only" onchange="document.getElementById('chip-number-input').classList.add('hidden')">
                                    <span class="text-sm font-bold">æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)</span>
                                </label>
                                <label class="flex-1 min-w-[30%] bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                                    <input type="radio" name="microchip_status" value="ç„¡æ™¶ç‰‡" class="sr-only" onchange="document.getElementById('chip-number-input').classList.add('hidden')">
                                    <span class="text-sm font-bold">ç„¡æ™¶ç‰‡</span>
                                </label>
                            </div>
                            <div id="chip-number-input" class="hidden animate-slide-up">
<input type="text" id="microchip_number" class="w-full bg-white border border-theme-primary rounded-xl px-4 py-3 text-theme-text focus:outline-none" placeholder="è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼">
                            </div>
                        </div>

<div class="grid grid-cols-2 gap-3">
    <div>
        <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ”»æ“Šæ€§*</label>
        <div class="flex gap-2">
            <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
<input type="radio" name="aggression" value="ç„¡æ”»æ“Šæ€§" class="sr-only">
                <span class="text-sm font-bold">ç„¡æ”»æ“Šæ€§</span>
            </label>
            <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                <input type="radio" name="aggression" value="æœ‰æ”»æ“Šæ€§" class="sr-only">
                <span class="text-sm font-bold">æœ‰æ”»æ“Šæ€§</span>
            </label>
        </div>
    </div>

    <div>
        <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">èˆ‡ç‹—ç›¸è™•*</label>
        <div class="flex gap-2">
            <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
<input type="radio" name="dog_social" value="å¯èˆ‡ç‹—ç©" class="sr-only">
                <span class="text-sm font-bold">å¯èˆ‡ç‹—ç©</span>
            </label>
            <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
                <input type="radio" name="dog_social" value="ä¸å¯èˆ‡ç‹—ç©" class="sr-only">
                <span class="text-sm font-bold">ä¸å¯èˆ‡ç‹—ç©</span>
            </label>
        </div>
    </div>
</div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ¯›å­©æ€§æƒ…*</label>
                            <div class="space-y-2">
                                <label class="flex items-start gap-3 p-3 bg-white/60 border border-theme-sub/20 rounded-xl cursor-pointer hover:bg-theme-primary/5 transition has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
<input type="radio" name="temperament" value="å¤©ä½¿å¯¶å¯¶" class="mt-1 accent-theme-dark">

                                    <div>
                                        <span class="block text-sm font-bold text-theme-text">ğŸ˜‡ å¤©ä½¿å¯¶å¯¶</span>
                                        <span class="block text-xs text-theme-sub mt-0.5">å€‹æ€§æº«å’Œï¼Œç„¡ä»»ä½•æ”»æ“Šç´€éŒ„ï¼Œä¹Ÿä¸æ€•ç”Ÿã€‚</span>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 p-3 bg-white/60 border border-theme-sub/20 rounded-xl cursor-pointer hover:bg-theme-primary/5 transition has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
<input type="radio" name="temperament" value="æœ‰é»ç·Šå¼µ" class="mt-1 accent-theme-dark">

                                    <div>
                                        <span class="block text-sm font-bold text-theme-text">ğŸ˜“ æœ‰é»ç·Šå¼µ</span>
                                        <span class="block text-xs text-theme-sub mt-0.5">è†½å°æ€•ç”Ÿï¼Œå¯èƒ½æœƒä½å¼æˆ–é–ƒèº²ï¼Œä½†æœªæ›¾å’¬äººã€‚</span>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 p-3 bg-white/60 border border-theme-sub/20 rounded-xl cursor-pointer hover:bg-theme-primary/5 transition has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
<input type="radio" name="temperament" value="æ•æ„Ÿå¯¶å¯¶" class="mt-1 accent-theme-dark">
                                    <div>
                                        <span class="block text-sm font-bold text-theme-text">ğŸ¤¬ æ•æ„Ÿå¯¶å¯¶</span>
                                        <span class="block text-xs text-theme-sub mt-0.5">ç‰¹å®šéƒ¨ä½æ•æ„Ÿæˆ–æ›¾æœ‰æ”»æ“Šç´€éŒ„ (è«‹å‹™å¿…å‘ŠçŸ¥)ã€‚</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">éå¾€ç—…å²*</label>
                            <div class="flex gap-2 mb-3">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-red-50 has-[:checked]:border-red-300 has-[:checked]:text-red-600 transition">
                                    <input type="radio" name="history_check" value="æœ‰ç—…å²" class="sr-only" onchange="document.getElementById('medical-history-input').classList.remove('hidden')">
                                    <span class="text-sm font-bold">æœ‰</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-lg py-2.5 text-center cursor-pointer has-[:checked]:bg-theme-primary/20 has-[:checked]:border-theme-primary transition">
<input type="radio" name="history_check" value="ç„¡ç—…å²" class="sr-only" onchange="document.getElementById('medical-history-input').classList.add('hidden')">
                                    <span class="text-sm font-bold">ç„¡</span>
                                </label>
                            </div>
                            <div id="medical-history-input" class="hidden animate-slide-up">
<textarea id="history_detail" class="w-full bg-white border border-red-200 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-red-400 transition h-24" placeholder="è«‹è©³ç´°èªªæ˜ç—…å²..."></textarea>
                            </div>

                            <div class="mt-3">
  <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">æŒ‡å®šé†«é™¢(è‹¥æœªå¡«å¯«å‰‡ä¾åº—å®¶æŒ‡å®š)</label>
  <input type="text" id="specified_hospital" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition" placeholder="è‹¥æœªå¡«å¯«å‰‡ä¾åº—å®¶æŒ‡å®š">
</div>

                            <div class="bg-theme-dark/5 rounded-xl p-3 border border-theme-dark/10">
    <span class="block text-xs font-bold text-theme-dark mb-1">ä¹™æ–¹æŒ‡å®šé†«é™¢ï¼š</span>
    <div class="text-xs text-theme-text space-y-1">
        <p class="font-bold">å¯Œå±±å‹•ç‰©é†«é™¢</p>
        <a href="https://www.google.com/maps/search/?api=1&query=è‡ºä¸­å¸‚åŒ—å±¯å€ä¸­æ¸…è·¯äºŒæ®µ11è™Ÿ" target="_blank" class="flex items-center gap-1.5 hover:text-theme-dark transition-colors group">
            <i data-lucide="map-pin" class="w-3 h-3 text-theme-sub group-hover:text-theme-primary"></i>
            <span>è‡ºä¸­å¸‚åŒ—å±¯å€ä¸­æ¸…è·¯äºŒæ®µ11è™Ÿ</span>
        </a>
    </div>
</div>

                        </div>
<div class="pt-2">
    <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">å¯µç‰©è¿‘å…©é€±å…§å…¨èº«ç…§*</label>
    <label class="w-full flex flex-col items-center justify-center gap-2 bg-white border border-dashed border-theme-sub/40 rounded-xl p-4 cursor-pointer hover:bg-theme-bg transition group">
<input type="file" id="pet_photo_file" accept="image/*" class="sr-only" onchange="previewPetPhoto(this)">
        
        <div id="pet-photo-preview-container" class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-theme-primary/10 flex items-center justify-center group-hover:bg-theme-primary/20">
                <i data-lucide="camera" class="w-4 h-4 text-theme-primary"></i>
            </div>
            <span id="pet-photo-upload-text" class="text-xs font-bold text-theme-sub group-hover:text-theme-primary">æ‹ç…§æˆ–å¾ç›¸ç°¿ä¸Šå‚³</span>
        </div>

        <!-- é è¦½åœ–ç‰‡ -->
        <img id="pet-photo-preview" class="hidden w-28 h-28 object-cover rounded-xl border border-theme-sub/30 mt-2" />
    </label>
</div>
                    </div>
                </div>

<div id="section-grooming" class="glass-panel p-6 rounded-2xl relative">
                    <div class="flex items-center gap-2 mb-6 border-b border-theme-sub/20 pb-3">
                        <span class="text-2xl">âœ‚ï¸</span>
                        <h3 class="font-bold text-theme-text text-lg">æœ¬æ¬¡æœå‹™å…§å®¹*</h3>
                    </div>

                    <div class="space-y-4">
                        <div class="space-y-3">
                            <label class="block relative cursor-pointer group">
                                <input type="checkbox" name="service" value="å°ç¾å®¹" class="peer hidden">
                                <div class="bg-white/60 border border-theme-sub/20 rounded-xl p-4 peer-checked:bg-theme-primary/10 peer-checked:border-theme-primary peer-checked:shadow-sm transition hover:border-theme-primary/40">
                                    <span class="font-bold text-theme-text text-lg block mb-1">å°ç¾å®¹</span>
                                    <p class="text-[11px] text-theme-sub leading-relaxed">äºŒæ¬¡æ´—æ¯›â†’æ½¤çµ²â†’å‰ª(ç£¨)æŒ‡ç”²â†’æ¸…è€³æœµâ†’å‰ƒè…³åº•ï¼‹è…¹éƒ¨ï¼‹è‚›é–€å‘¨åœæ¯›â†’æ“ è‚›é–€è…ºâ†’ä¿®çœ¼ç›å˜´å·´å‘¨åœé›œæ¯›</p>
                                </div>
                            </label>

                            <label class="block relative cursor-pointer group">
                                <input type="checkbox" name="service" value="å¤§ç¾å®¹" class="peer hidden">
                                <div class="bg-white/60 border border-theme-sub/20 rounded-xl p-4 peer-checked:bg-theme-primary/10 peer-checked:border-theme-primary peer-checked:shadow-sm transition hover:border-theme-primary/40">
                                    <span class="font-bold text-theme-text text-lg block mb-1">å¤§ç¾å®¹</span>
                                    <p class="text-[11px] text-theme-sub leading-relaxed">åŒ…å«å°ç¾å®¹æ‰€æœ‰é …ç›®ï¼Œå¤–åŠ å…¨èº«é€ å‹ä¿®å‰ª</p>
                                </div>
                            </label>
                        </div>

                        <div class="pt-4 space-y-2">
                            <h4 class="text-xs font-bold text-theme-dark flex items-center gap-1 mb-3 ml-1">
                                <i data-lucide="sparkles" class="w-3 h-3 text-theme-primary"></i> å‡ç´šæœå‹™èˆ‡åŠ è³¼
                            </h4>
                            
                            <div class="bg-white/40 border border-theme-sub/10 rounded-2xl p-2 space-y-1">
                                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 transition-all cursor-pointer group has-[:checked]:bg-theme-primary/5 has-[:checked]:border-theme-primary/20">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" name="upgrade_service" value="å±€éƒ¨ä¿®é£¾" class="accent-theme-primary w-4 h-4">
                                        <div>
                                            <span class="text-sm font-bold text-theme-text block">å±€éƒ¨ä¿®é£¾</span>
                                            <span class="text-[10px] text-theme-sub">è²´è³“è‡‰/è…³</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 transition-all cursor-pointer group has-[:checked]:bg-theme-primary/5 has-[:checked]:border-theme-primary/20">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" name="upgrade_service" value="ç‰¹æ®Šé€ å‹" class="accent-theme-primary w-4 h-4">
                                        <div>
                                            <span class="text-sm font-bold text-theme-text block">ç‰¹æ®Šé€ å‹</span>
                                            <span class="text-[10px] text-theme-sub">è…³çƒ/è…³æŸ±</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 transition-all cursor-pointer group has-[:checked]:bg-theme-primary/5 has-[:checked]:border-theme-primary/20">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" name="upgrade_service" value="å…¨èº«æ‰‹å‰ª" class="accent-theme-primary w-4 h-4">
                                        <div>
                                            <span class="text-sm font-bold text-theme-text block">å…¨èº«æ‰‹å‰ª</span>
                                            <span class="text-[10px] text-theme-sub">å…¨èº«é€ å‹</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 transition-all cursor-pointer group has-[:checked]:bg-theme-primary/5 has-[:checked]:border-theme-primary/20">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" name="upgrade_service" value="æ·±å±¤æ¸…æ½”æ°´ç™‚" class="accent-theme-primary w-4 h-4">
                                        <div>
                                            <span class="text-sm font-bold text-theme-text block">æ·±å±¤æ¸…æ½”æ°´ç™‚</span>
                                            <span class="text-[10px] text-theme-sub">æ·±å±¤å»é™¤æ¯›å­”æ±™å¢èˆ‡æ²¹è„‚</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="flex items-center justify-between p-3 rounded-xl border border-transparent hover:bg-white/80 transition-all cursor-pointer group has-[:checked]:bg-theme-primary/5 has-[:checked]:border-theme-primary/20">
                                    <div class="flex items-center gap-3">
                                        <input type="checkbox" name="upgrade_service" value="å¯µç‰©å®‰è¦ª" class="accent-theme-primary w-4 h-4">
                                        <div>
                                            <span class="text-sm font-bold text-theme-text block">å¯µç‰©å®‰è¦ª</span>
                                            <span class="text-[10px] text-theme-sub">æä¾›ç¾å®¹æœŸé–“ä»¥å¤–çš„ç…§è­·æœå‹™</span>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <div class="mt-2">
                                <label class="block relative cursor-pointer">
                                   <input type="checkbox" name="service" value="å…¶ä»–" class="peer hidden" onchange="document.getElementById('other-service-input').classList.toggle('hidden')">
                                   <div class="bg-white/60 border border-theme-sub/20 rounded-xl p-3 peer-checked:bg-theme-primary/10 peer-checked:border-theme-primary transition flex items-center justify-between">
                                       <span class="text-sm font-bold text-theme-text">å…¶ä»–é …ç›®</span>
                                       <i data-lucide="plus" class="w-4 h-4 text-theme-sub"></i>
                                   </div>
                               </label>
                               <div id="other-service-input" class="hidden mt-2 animate-slide-up">
<input type="text" id="other_service_text" class="w-full bg-white border border-theme-sub/30 rounded-xl px-4 py-2 text-sm text-theme-text focus:outline-none focus:border-theme-primary" placeholder="è«‹åœ¨æ­¤èªªæ˜å…¶ä»–éœ€æ±‚...">
                               </div>
                           </div>
                        </div>

                        <div class="pt-6 border-t border-theme-sub/20 space-y-5">
                            <label class="flex items-center gap-3 p-4 bg-white/60 border border-theme-sub/20 rounded-2xl cursor-pointer hover:border-theme-primary/50 transition has-[:checked]:bg-theme-primary/5" onclick="toggleMatting(this)">
                                <input type="checkbox" name="matting_suspected" class="w-4 h-4 accent-theme-primary">
                                <div class="flex-1">
                                    <span class="text-sm font-bold text-theme-text flex items-center gap-2">
                                        ç–‘ä¼¼æœ‰æ‰“çµ <span class="text-[10px] bg-theme-primary/20 text-theme-dark px-2 py-0.5 rounded-full">éœ€ç¾å ´è©•ä¼°</span>
                                    </span>
                                    <span class="text-[10px] text-theme-sub mt-0.5 block font-bold">ç¾å ´è©•ä¼°æ‹†çµè²»ç”¨ 300å…ƒï½2000å…ƒ</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-theme-sub transition-transform" id="matting-arrow"></i>
                            </label>

                            <div id="matting-details" class="hidden animate-slide-up bg-white/40 rounded-2xl p-4 border border-theme-sub/10 space-y-4">
                                <p class="text-[11px] text-theme-dark font-bold border-l-4 border-theme-primary pl-2">æ¯›é«®æ‰“çµè™•ç†æ–¹å¼ï¼ˆè«‹æ“‡ä¸€å‹¾é¸ï¼‰</p>
                                <div class="space-y-3">
                                    <label class="block p-3 rounded-xl border border-theme-sub/10 bg-white/80 cursor-pointer hover:border-theme-primary/50 transition-colors">
                                        <div class="flex items-start gap-3">
                                            <input type="radio" name="matting_choice" value="æ–¹æ¡ˆä¸€" class="mt-1 accent-theme-primary shrink-0">
                                            <div class="space-y-1">
                                                <span class="text-xs font-bold text-theme-text block">æ–¹æ¡ˆä¸€ | æ‹†çµè™•ç† (éœ€å¦è¨ˆè²»)</span>
                                                <p class="text-[10px] text-theme-sub leading-relaxed text-justify">
                                                    æœ¬äººåŒæ„ç”±ç¾å®¹å¸«é€²è¡Œæ‹†çµè™•ç†ï¼Œä¸¦é¡˜æ„æ”¯ä»˜æ‹†çµè²»ç”¨ã€‚äº†è§£éç¨‹ä¸­å¯èƒ½ç”¢ç”Ÿæ¯›é«®æ–·è£‚ã€æ¯›é‡æ¸›å°‘å±¬æ­£å¸¸æƒ…æ³ã€‚
                                                    <span class="text-red-500 font-bold">è²»ç”¨ç‚º NT$300ï½NT$2000ä¸ç­‰</span>ã€‚
                                                </p>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="block p-3 rounded-xl border border-theme-sub/10 bg-white/80 cursor-pointer hover:border-theme-primary/50 transition-colors">
                                        <div class="flex items-start gap-3">
                                            <input type="radio" name="matting_choice" value="æ–¹æ¡ˆäºŒ" class="mt-1 accent-theme-primary shrink-0">
                                            <div class="space-y-1">
                                                <span class="text-xs font-bold text-theme-text block">æ–¹æ¡ˆäºŒ | ä¸æ‹†çµï¼Œç›´æ¥ä¿®å‰ª</span>
                                                <p class="text-[10px] text-theme-sub leading-relaxed text-justify">
                                                    ä¸é¡˜æ„æ”¯ä»˜æ‹†çµè²»ï¼ŒåŒæ„ç¾å®¹å¸«é‡æ‰“çµæ™‚ç›´æ¥ä¿®å‰ªï¼Œäº†è§£å¤–è§€å¯èƒ½å‡ºç¾é•·çŸ­ä¸ä¸€æˆ–å±€éƒ¨ç¨€ç–ä¹‹æƒ…å½¢ï¼Œä¸å› æ­¤æå‡ºç•°è­°ã€‚
                                                </p>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                                <div class="bg-theme-bg/50 p-3 rounded-xl space-y-2 border border-theme-sub/10 text-[10px] text-theme-sub leading-relaxed">
                                    <p><strong>è£œå……èªªæ˜ï¼š</strong>å¯¦éš›è™•ç†æ–¹å¼ç”±ç¾å®¹å¸«ä¾æ¯›å­©çš®è†šç‹€æ…‹èˆ‡å®‰å…¨è€ƒé‡åšå°ˆæ¥­åˆ¤æ–·ã€‚å¦‚æ‰“çµåš´é‡è‡´å—å‚·é¢¨éšªéé«˜ï¼Œæœ¬åº—ä¿æœ‰ä¸­æ­¢æœå‹™æ¬Šåˆ©ã€‚</p>
                                </div>
                            </div>

                            <div class="bg-theme-bg/50 border border-theme-sub/20 rounded-2xl p-5 space-y-4 shadow-inner">
                                <div class="flex items-center gap-2 text-theme-text">
                                    <i data-lucide="clock" class="w-4 h-4 text-theme-primary"></i>
                                    <span class="text-xs font-bold">é€¾æ™‚èˆ‡å®‰ç½®è²»ç”¨èªªæ˜</span>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="bg-white/80 p-3 rounded-xl text-center border border-white">
                                        <span class="text-[10px] text-theme-sub block mb-1">1å°æ™‚å…§</span>
                                        <span class="text-sm font-black text-theme-text">å…æ”¶è²»</span>
                                    </div>
                                    <div class="bg-white/80 p-3 rounded-xl text-center border border-white">
                                        <span class="text-[10px] text-theme-sub block mb-1">è¶…é1å°æ™‚</span>
                                        <span class="text-sm font-black text-theme-text">$200 / hr</span>
                                    </div>
                                </div>
                                <div class="bg-red-50 p-3 rounded-xl border border-red-100 flex gap-3">
                                    <i data-lucide="alert-circle" class="w-4 h-4 text-red-400 shrink-0 mt-0.5"></i>
                                    <p class="text-[10px] text-red-800 leading-relaxed font-bold">
                                        è¶…é 1 å°æ™‚ä»¥ä¸Šï¼Œæœ¬åº—å°‡å…ˆè¡Œ<span class="bg-red-200 text-red-900 px-1 rounded mx-0.5">å®‰ç½®çŠ¬è²“</span> (æä¾›æ°´ã€é£¼æ–™)ï¼Œå±†æ™‚å°‡æ”¶å–å¿…è¦ä¹‹å®‰ç½®è²»ç”¨ã€‚
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

<div id="section-boarding" class="glass-panel p-6 rounded-2xl relative hidden">
                    <div class="flex items-center justify-between mb-6 border-b border-theme-sub/20 pb-3">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">ğŸ </span>
                            <h3 class="font-bold text-theme-text text-lg">ä½å®¿è³‡æ–™</h3>
                        </div>
                        
                        <div class="flex bg-theme-sub/10 p-1 rounded-lg">
                            <button type="button" onclick="toggleBoardingType('overnight')" id="tab-overnight" class="px-4 py-1.5 rounded-md text-xs font-bold transition-all bg-white text-theme-primary shadow-sm">ä½å®¿</button>
                            <button type="button" onclick="toggleBoardingType('daycare')" id="tab-daycare" class="px-4 py-1.5 rounded-md text-xs font-bold transition-all text-theme-sub hover:text-theme-text">å®‰è¦ª</button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        
                        <div id="date-section-overnight" class="animate-fade-in">
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">å…¥ä½æ—¥æœŸ *</label>
<input type="date" id="checkin_date" class="w-full bg-white border border-theme-sub/30 rounded-xl px-3 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">é€€æˆ¿æ—¥æœŸ *</label>
<input type="date" id="checkout_date" class="w-full bg-white border border-theme-sub/30 rounded-xl px-3 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                                </div>
                            </div>
                        </div>

                        <div id="date-section-daycare" class="hidden animate-fade-in">
                            <div class="mb-3">
                                <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">å®‰è¦ªæ—¥æœŸ *</label>
<input type="date" id="daycare_date" class="w-full bg-white border border-theme-sub/30 rounded-xl px-3 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">æŠµé”æ™‚é–“</label>
                                    <input type="time" id="arrive_time" class="w-full bg-white border border-theme-sub/30 rounded-xl px-3 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">æ¥å›æ™‚é–“</label>
                                    <input type="time" id="leave_time" class="w-full bg-white border border-theme-sub/30 rounded-xl px-3 py-3 text-sm text-theme-text focus:outline-none focus:border-theme-primary transition">
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ˜¯å¦æ¯å€‹æœˆå®šæœŸé©…èŸ²å‘¢*</label>
                            <div class="flex gap-3 mb-2">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="deworming" value="æœ‰å®šæœŸé©…èŸ²" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">æ˜¯</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="deworming" value="ç„¡å®šæœŸé©…èŸ²" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">å¦</span>
                                </label>
                            </div>
<input type="text" id="deworming_brand" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-2 text-sm text-theme-text focus:outline-none focus:border-theme-primary" placeholder="è«‹è¼¸å…¥é©…èŸ²è—¥ç‰Œå­ï¼ˆä¾‹å¦‚ï¼šå…¨èƒ½ç‹—ã€ä¸€éŒ é™¤...ï¼‰">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æ˜¯å¦æ˜“å å«å‘¢*</label>
                            <div class="flex gap-3 mb-2">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="barking" value="æ˜“å å«" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">æ˜¯</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="barking" value="ä¸æ˜“å å«" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">å¦</span>
                                </label>
                            </div>
<input type="text" id="barking_note" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-2 text-sm text-theme-text focus:outline-none focus:border-theme-primary" placeholder="ä»€éº¼æƒ…æ³ä¸‹æœƒå å«å‘¢">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æœƒè­·é£Ÿå—*</label>
                            <div class="flex gap-3 mb-2">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="food_guard" value="æœƒè­·é£Ÿ" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">æœƒ</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="food_guard" value="ä¸æœƒè­·é£Ÿ" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">ä¸æœƒ</span>
                                </label>
                            </div>
<input type="text" id="food_guard_note" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-2 text-sm text-theme-text focus:outline-none focus:border-theme-primary" placeholder="å…¶ä»–èªªæ˜...">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">æœƒåœ¨å°¿å¸ƒå¢Šä¸Šå»æ‰€å—*</label>
                            <div class="flex gap-3 mb-2">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="toilet" value="æœƒç”¨å°¿å¸ƒå¢Š" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">æœƒ</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="toilet" value="ä¸æœƒç”¨å°¿å¸ƒå¢Š" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">ä¸æœƒ</span>
                                </label>
                            </div>
<input type="text" id="toilet_note" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-2 text-sm text-theme-text focus:outline-none focus:border-theme-primary" placeholder="å…¶ä»–èªªæ˜...">
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-2 ml-1">ç–«è‹—æ˜¯å¦æ¯å¹´éƒ½æœ‰å®šæœŸæ–½æ‰“å‘¢ (è«‹æä¾›ç…§ç‰‡)*</label>
                            <div class="flex gap-3 mb-3">
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="vaccine" value="æœ‰å®šæœŸæ‰“ç–«è‹—" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">æ˜¯</span>
                                </label>
                                <label class="flex-1 bg-white/60 border border-theme-sub/20 rounded-xl p-3 flex items-center justify-center gap-2 cursor-pointer has-[:checked]:bg-theme-primary/10 has-[:checked]:border-theme-primary">
                                    <input type="radio" name="vaccine" value="æ²’æœ‰å®šæœŸæ‰“ç–«è‹—" class="sr-only">
                                    <span class="text-sm font-bold text-theme-text">å¦</span>
                                </label>
                            </div>
<label class="w-full flex flex-col items-center justify-center gap-2 bg-white border border-dashed border-theme-sub/40 rounded-xl p-4 cursor-pointer hover:bg-theme-bg transition group">
<input type="file" id="vaccine_photo_file" accept="image/*" class="sr-only" onchange="previewImage(this)">
    
    <div id="upload-preview-container" class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-full bg-theme-primary/10 flex items-center justify-center group-hover:bg-theme-primary/20">
            <i data-lucide="camera" class="w-4 h-4 text-theme-primary"></i>
        </div>
        <span id="upload-text" class="text-xs font-bold text-theme-sub group-hover:text-theme-primary">æ‹ç…§æˆ–å¾ç›¸ç°¿ä¸Šå‚³æ‰‹å†Šç…§ç‰‡</span>
    </div>

    <!-- é è¦½åœ–ç‰‡ -->
    <img id="vaccine-photo-preview" class="hidden w-28 h-28 object-cover rounded-xl border border-theme-sub/30 mt-2" />
</label>
                        </div>

                        <div>
                            <label class="block text-xs font-bold text-theme-sub mb-1.5 ml-1">å¯¶è²æœ‰éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„åœ°æ–¹éƒ½å¯ä»¥å‘ŠçŸ¥å“¦ï¼</label>
<textarea id="boarding_note" class="w-full bg-white/60 border border-theme-sub/30 rounded-xl px-4 py-3 text-theme-text focus:outline-none focus:border-theme-primary transition h-24" placeholder="ä¾‹å¦‚ï¼šç‰¹åˆ¥è†½å°ã€æˆ–æ˜¯å“ªè£¡ä¸èƒ½æ‘¸..."></textarea>
                        </div>
                    </div><div class="mb-10 space-y-6 animate-slide-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center gap-3 ml-1 mb-2">
                        <div class="w-2 h-6 bg-theme-primary rounded-full shadow-[0_0_10px_rgba(165,196,174,0.5)]"></div>
                        <h4 class="text-base font-black text-theme-text tracking-[0.2em]">ä½å®¿é ˆçŸ¥èˆ‡è¦ç¯„æ‰‹å†Š</h4>
                    </div>
                    
                    <div class="space-y-4">
                        <details class="group bg-white border border-theme-sub/20 rounded-2xl overflow-hidden shadow-sm transition-all" open>
                            <summary class="flex items-center justify-between p-5 cursor-pointer list-none bg-theme-bg/30">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-theme-primary text-white flex items-center justify-center shadow-sm">
                                        <i data-lucide="calculator" class="w-5 h-5"></i>
                                    </div>
                                    <div class="text-left">
                                        <p class="text-xs text-theme-sub font-bold tracking-widest">PRICING</p>
                                        <p class="font-black text-theme-text">ä½å®¿è²»ç”¨èˆ‡å„ªæƒ æ–¹æ¡ˆ</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-theme-sub group-open:rotate-180 transition-transform"></i>
                            </summary>
                            <div class="p-6 space-y-5">
                                <div class="grid grid-cols-3 gap-3">
                                    <div class="bg-white border border-theme-sub/10 p-3 rounded-2xl text-center shadow-sm">
                                        <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" class="w-8 h-8 mx-auto mb-2 opacity-80">
                                        <p class="text-[10px] font-bold text-theme-sub">5KG ä»¥ä¸‹</p>
                                        <p class="text-sm font-black text-theme-text">NT$ 700<span class="text-[10px] font-normal">/æ™š</span></p>
                                    </div>
                                    <div class="bg-white border border-theme-sub/10 p-3 rounded-2xl text-center shadow-sm">
                                        <img src="https://cdn-icons-png.flaticon.com/512/616/616554.png" class="w-8 h-8 mx-auto mb-2 opacity-80">
                                        <p class="text-[10px] font-bold text-theme-sub">10KG ä»¥ä¸‹</p>
                                        <p class="text-sm font-black text-theme-text">NT$ 800<span class="text-[10px] font-normal">/æ™š</span></p>
                                    </div>
                                    <div class="bg-white border border-theme-sub/10 p-3 rounded-2xl text-center shadow-sm">
                                        <img src="https://cdn-icons-png.flaticon.com/512/616/616556.png" class="w-8 h-8 mx-auto mb-2 opacity-80">
                                        <p class="text-[10px] font-bold text-theme-sub">15KG ä»¥ä¸‹</p>
                                        <p class="text-sm font-black text-theme-text">NT$ 900<span class="text-[10px] font-normal">/æ™š</span></p>
                                    </div>
                                </div>
                                <p class="text-[11px] text-theme-sub bg-theme-bg/50 p-3 rounded-xl border-l-4 border-theme-primary leading-relaxed">
                                    è«‹å…ˆåŠ  LINE é ç´„æ™‚é–“ï¼Œä¸¦ç¢ºèªæ˜¯å¦æœ‰ç©ºæˆ¿ã€‚<br>
                                    è‹¥è¶…é 15KG çš„æ¯›å­©è«‹äº‹å…ˆè©¢å•ã€‚
                                </p>
                                <div class="space-y-3">
                                    <h5 class="text-xs font-black text-theme-text flex items-center gap-2">ä½å®¿åˆ¸å„ªæƒ  (éœ€ä¸€æ¬¡ä»˜æ¸…)</h5>
                                    <div class="flex gap-3">
                                        <div class="flex-1 bg-gradient-to-br from-theme-primary/10 to-transparent p-4 rounded-2xl border border-theme-primary/20 relative">
                                            <p class="text-xs font-bold text-theme-dark">A. 10æ™š äº«9æŠ˜</p>
                                            <p class="text-[9px] text-theme-sub mt-1">éœ€æ–¼ 45å¤©å…§ä½¿ç”¨å®Œç•¢</p>
                                        </div>
                                        <div class="flex-1 bg-gradient-to-br from-theme-dark/10 to-transparent p-4 rounded-2xl border border-theme-dark/20 relative">
                                            <p class="text-xs font-bold text-theme-dark">B. 20æ™š äº«8æŠ˜</p>
                                            <p class="text-[9px] text-theme-sub mt-1">éœ€æ–¼ 60å¤©å…§ä½¿ç”¨å®Œç•¢</p>
                                        </div>
                                    </div>
                                    <ul class="text-[10px] text-theme-sub space-y-1.5 list-disc pl-4 mt-2">
                                        <li>è¾²æ›†æ–°å¹´æˆ–ç‰¹æ®Šç¯€æ—¥åƒ¹æ ¼å¦è¨ˆï¼Œè«‹äº‹å…ˆé ç´„ä¸¦æ´½è©¢ã€‚</li>
                                        <li>è³¼è²·ä½å®¿åˆ¸æœªæ–¼æœŸé™å…§ä½¿ç”¨å®Œç•¢ï¼Œå¯è£œå·®é¡ç¹¼çºŒä½¿ç”¨ã€‚</li>
                                        <li>ä½¿ç”¨ä½å®¿åˆ¸åƒ…èƒ½æŠ˜æŠµä½å®¿è²»ç”¨ï¼Œè‹¥é‡åˆ°éœ€é¡å¤–ç‹€æ³éœ€å¦æ”¶è²»æ™‚ä»éœ€è£œé½Šè²»ç”¨ã€‚</li>
                                        <li>å…¥ä½å‰ä¸‰å¤©å–æ¶ˆæ•ä¸é€€æ¬¾ï¼Œè²»ç”¨å°‡è½‰æˆç‚ºå„²å€¼é‡‘ä¾›æœªä¾†ä½¿ç”¨ã€‚</li>
                                        <li>ä»»ä½•ä½å®¿ç‹€æ³æ­¡è¿äº‹å…ˆä»¥ LINE@ è©¢å•ã€‚</li>
                                    </ul>
                                </div>
                            </div>
                        </details>

                        <details class="group bg-white border border-theme-sub/20 rounded-2xl overflow-hidden shadow-sm transition-all">
                            <summary class="flex items-center justify-between p-5 cursor-pointer list-none">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-theme-primary/10 text-theme-primary flex items-center justify-center">
                                        <i data-lucide="info" class="w-5 h-5"></i>
                                    </div>
                                    <span class="font-black text-theme-text">ä½å®¿é ˆçŸ¥ç´°å‰‡</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-theme-sub group-open:rotate-180 transition-transform"></i>
                            </summary>
                            <div class="p-6 space-y-5 text-xs text-theme-text leading-relaxed">
                                <div class="space-y-4">
                                    <div class="flex gap-4 items-start">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary text-white flex-shrink-0 flex items-center justify-center font-bold">A</span>
                                        <div>
                                            <p class="font-bold text-theme-dark">é ç´„åˆ¶åº¦</p>
                                            <p class="text-theme-sub mt-1">åªæ¡é ç´„åˆ¶ï¼Œä½å®¿å‰è«‹å…ˆåŠ  LINE å¡«å¯«ä½å®¿é ç´„è¡¨ã€‚ä½å®¿éœ€æ­é…ç¾å®¹ï¼Œç¾å®¹å¸«æœƒæ–¼ç¾å®¹éç¨‹ä¸­æª¢è¦–å¯¶è²ç‹€æ³æ˜¯å¦å¯ä»¥ä½å®¿ (ç¾å®¹åƒ¹æ ¼å¦è¨ˆ)ï¼Œä¸æ¥å—è‡¨æ™‚ä½å®¿å”·ï¼</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start border-t border-gray-100 pt-4">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary text-white flex-shrink-0 flex items-center justify-center font-bold">B</span>
                                        <div>
                                            <p class="font-bold text-theme-dark">å…¥ä½ / é€€æˆ¿æ™‚é–“</p>
                                            <p class="text-theme-sub mt-1">å…¥ä½åŠé€€æˆ¿æ™‚é–“ç‚º <b class="text-theme-text">æ—©ä¸Š10:00 â€“ æ™šä¸Š18:00</b>ï¼Œä»¥éå¤œè¨ˆåƒ¹ã€‚æå‰å…¥ä½ / å»¶å¾Œæ¥å› éœ€é…Œæ”¶åŠ æ™‚è²»ç”¨ 200/å°æ™‚ï¼Œè¶…é 19:00 æœªæ¥å›å‰‡ <b class="text-red-500">è¦–åŒéå¤œå”·ï¼</b> è«‹æ–¼éš”å¤©å†ä¾†æ¥å›ï¼Œä¸¦è£œæ”¶ä¸€æ™šä½å®¿è²»ç”¨ã€‚</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start border-t border-gray-100 pt-4">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary text-white flex-shrink-0 flex items-center justify-center font-bold">C</span>
                                        <div>
                                            <p class="font-bold text-theme-dark">ç‹—ç‹—ç‹€æ³</p>
                                            <p class="text-theme-sub mt-1">é¦–æ¬¡ä¾†æœ¬é¤¨ä½å®¿ä¹‹å¯¶è²ï¼Œéœ€ <b class="text-theme-text">å®‰è¦ª2~3å€‹å°æ™‚</b> é€²è¡Œå®‰è¦ªè©•ä¼°ï¼Œç¢ºä¿å¯¶è²æ²’æœ‰æ”»æ“Šæ€§åŠä¸æœƒå› ç‚ºä¸ç†Ÿæ‚‰ç’°å¢ƒè€Œç™¼ç”Ÿä¸é©æ‡‰ä¹‹æƒ…æ³ï¼Œå®‰è¦ªèˆ‡ä½å®¿éœ€ä¸åŒå¤©ï¼›ä¸¦å¦å¤–æä¾›å¯¶è²çš„ <b class="text-theme-text">å¯µç‰©æ‰‹å†Šæ­£æœ¬åŠç–«è‹—è­‰æ˜</b> (å¹¼çŠ¬éœ€æ‰“æ»¿ä¸‰åŠ‘ç–«è‹—ï¼ŒæˆçŠ¬éœ€å‡ºç¤ºä¸€å¹´å…§ç‹‚çŠ¬è­‰æ˜) æ‹ç…§å³å¯ï¼Œä¸¦ä¸”çš†é ˆå®Œæˆé©…èŸ²ï¼Œå¦‚æœ‰ç™¼ç¾èŸ²é«”ï¼Œå‰‡ä¸æä¾›ä½å®¿ä¸¦ä¸”å°‡å¦å¤–æ”¶å–ç’°å¢ƒæ¸…æ½”è²»ç”¨ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </details>

                        <details class="group bg-white border border-theme-sub/20 rounded-2xl overflow-hidden shadow-sm transition-all">
                            <summary class="flex items-center justify-between p-5 cursor-pointer list-none">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-theme-primary/10 text-theme-primary flex items-center justify-center">
                                        <i data-lucide="star" class="w-5 h-5"></i>
                                    </div>
                                    <span class="font-black text-theme-text">å¤§æŸ´å°ç†Šä½å®¿ç‰¹è‰²</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-theme-sub group-open:rotate-180 transition-transform"></i>
                            </summary>
                            <div class="p-6 space-y-4">
                                <div class="grid grid-cols-1 gap-3">
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">âœï¸ é ç´„åˆ¶åº¦ / ä¸è¶…æ”¶</p>
                                        <p class="text-[10px] text-theme-sub mt-1">æˆ‘å€‘å…¨æ¡ä¸é—œç± ä½å®¿ï¼Œç‚ºç¢ºä¿æ¯ä½ä½å®¢éƒ½èƒ½äº«æœ‰è‡ªåœ¨èˆ’é©çš„ç©ºé–“ï¼Œæˆ‘å€‘åªæä¾›é ç´„ä¸¦ä¸”ä¸è¶…æ”¶ã€‚</p>
                                    </div>
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">â¤ï¸ ä¸é—œç± </p>
                                        <p class="text-[10px] text-theme-sub mt-1">ä¸é—œç± é™åˆ¶æ´»å‹•ç©ºé–“ï¼Œä½†æ¯éš»å¯¶è²éƒ½èƒ½æœ‰ç¨ç«‹æˆ¿é–“ï¼Œä¼‘æ¯åŠåƒé£¯çš„æ™‚å€™éƒ½èƒ½å®‰å¿ƒä¸è¢«æ‰“æ“¾å”·ï¼</p>
                                    </div>
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">ğŸŒ± ç¨ç«‹çœŸè‰çš®å€</p>
                                        <p class="text-[10px] text-theme-sub mt-1">è®“å¯¶è²å³ä¾¿ä¸å‡ºé–€ä¹Ÿèƒ½äº«å—é™½å…‰åŠè‡ªç„¶çš„ç’°å¢ƒï¼Œèƒ½è‡ªç”±è‡ªåœ¨çš„äº¤å‹ï¼Œé™ä½å¯‚å¯æ„Ÿï¼Œä¸¦ä¸”æˆ‘å€‘ç¨®æ¤çš„çœŸè‰çš®æœƒæ¯”äººå·¥è‰çš®æ›´ä¸å®¹æ˜“æœ‰ç•°å‘³å”·ã€‚</p>
                                    </div>
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">ğŸ° å¤§æ´»å‹•ç©ºé–“</p>
                                        <p class="text-[10px] text-theme-sub mt-1">è®“å¯¶è²è‡ªç”±æ´»å‹•ä¸å—é™ï¼Œä¸éœ€è¦åˆ°æˆ¶å¤–ï¼Œæ›´èƒ½æ¸›å°‘åœ¨æˆ¶å¤–èµ°å¤±çš„é¢¨éšªã€‚</p>
                                    </div>
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">ğŸ  å¤šå…ƒä½å®¿</p>
                                        <p class="text-[10px] text-theme-sub mt-1">ç¤¾ç‰›ç‹—å¯¶è²å¯ä»¥é–‹å¿ƒèˆ‡å…¶ä»–ç‹—åŒå­¸ç©è€äº«å—ç¤¾äº¤ï¼Œç¤¾æç‹—å¯¶è²ä¹Ÿæœƒæœ‰ç¨è‡ªçš„æ´»å‹•ç©ºé–“ä¸å¼·è¿«ç¤¾äº¤ä¸ç”¨å®³æ€•å”·ï¼</p>
                                    </div>
                                    <div class="p-3 bg-theme-bg/30 rounded-xl border border-white">
                                        <p class="text-xs font-bold text-theme-text">ğŸ“· ä¸»å‹•å›å ±</p>
                                        <p class="text-[10px] text-theme-sub mt-1">æ¯å¤©ä»¥å½±ç‰‡æˆ–ç…§ç‰‡å›å ±å®¶ä¸­å¯¶è²ç‹€æ³ï¼Œè®“å¿™ç¢Œçš„æ‚¨ä¹Ÿèƒ½è¢«å‹•æ¥æ”¶å¯¶è²ç‹€æ³ã€‚</p>
                                    </div>
                                </div>
                            </div>
                        </details>

                        <details class="group bg-white border border-theme-sub/20 rounded-2xl overflow-hidden shadow-sm transition-all">
                            <summary class="flex items-center justify-between p-5 cursor-pointer list-none">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-theme-primary/10 text-theme-primary flex items-center justify-center">
                                        <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                                    </div>
                                    <span class="font-black text-theme-text">å…¥ä½è‡ªå‚™æ¸…å–®</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-theme-sub group-open:rotate-180 transition-transform"></i>
                            </summary>
                            <div class="p-6 space-y-5 text-xs text-theme-text leading-relaxed">
                                <div class="space-y-4">
                                    <div class="flex gap-4 items-start">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary/20 text-theme-primary flex-shrink-0 flex items-center justify-center font-bold">A</span>
                                        <div>
                                            <p class="font-bold">å¯¶è²åƒé£Ÿ</p>
                                            <p class="text-theme-sub mt-1">é é˜²å¯¶è²åˆ°æ–°ç’°å¢ƒä½å®¿ä¸ç¿’æ…£å®¹æ˜“æ‹‰è‚šå­ï¼Œè«‹æ”œå¸¶å¯¶è²å¹³å¸¸ç¿’æ…£çš„åƒé£Ÿã€é›¶é£Ÿã€‚</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary/20 text-theme-primary flex-shrink-0 flex items-center justify-center font-bold">B</span>
                                        <div>
                                            <p class="font-bold">å°¿å¸ƒ / å°¿å¸ƒå¢Š</p>
                                            <p class="text-theme-sub mt-1">ç‚ºé¿å…è®“æ¯›å­©ç·Šå¼µåœ¨æˆ¿å…§éš¨è™•å¤§å°ä¾¿ï¼Œè«‹è‡ªå‚™å°¿å¸ƒå¢Šæˆ–ç¦®è²Œå¸¶é¿å…å¯¶è²å‡ºç¾ä½”åœ°èˆ‰å‹•ã€‚</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary/20 text-theme-primary flex-shrink-0 flex items-center justify-center font-bold">C</span>
                                        <div>
                                            <p class="font-bold">èº«é‚Šå°ç‰©</p>
                                            <p class="text-theme-sub mt-1">å®¶é•·å¯ä»¥æº–å‚™è‡ªå·±çš„è¡£ç‰©æˆ–æ˜¯å¹³å¸¸ç†Ÿæ‚‰çš„å°è¢«å­ï¼Œæˆ–è€…å¯¶è²ç¿’æ…£çš„ç©å…·ï¼Œæœ‰å®¶è£¡çš„å‘³é“å¯ä»¥å¢åŠ å¯¶è²çš„å®‰å…¨æ„Ÿã€‚(ä½†æˆ‘å€‘ä¸å°ç‰©å“æå£è² è²¬å”·ï¼å› ç‚ºç„¡æ³•æ§åˆ¶æ‚¨çš„å¯¶è²å¦‚ä½•å°å¾…æ‚¨æä¾›çš„ç‰©å“)</p>
                                        </div>
                                    </div>
                                    <div class="flex gap-4 items-start">
                                        <span class="w-6 h-6 rounded-full bg-theme-primary/20 text-theme-primary flex-shrink-0 flex items-center justify-center font-bold">D</span>
                                        <div>
                                            <p class="font-bold">æ…£ç”¨è—¥å“ / ä¿å¥å“</p>
                                            <p class="text-theme-sub mt-1">å¦‚æœå®¶ä¸­å¯¶è²åœ¨ä½å®¿æœŸé–“æœ‰æœè—¥ã€åƒä¿å¥å“çš„éœ€æ±‚ï¼Œè«‹æº–å‚™å¥½ä¸¦å‘ŠçŸ¥å¹³å¸¸é£Ÿç”¨çš„æŒ‡ç¤ºã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </details>

                        <details class="group bg-red-50/50 border border-red-200 rounded-2xl overflow-hidden shadow-sm transition-all">
                            <summary class="flex items-center justify-between p-5 cursor-pointer list-none">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-xl bg-red-500 text-white flex items-center justify-center shadow-lg shadow-red-200">
                                        <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                                    </div>
                                    <span class="font-black text-red-700">ä»¥ä¸‹æƒ…æ³ä¸æä¾›ä½å®¿æœå‹™</span>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-red-300 group-open:rotate-180 transition-transform"></i>
                            </summary>
                            <div class="p-6 space-y-4">
                                <p class="text-[11px] text-red-600 font-bold leading-relaxed">ç‚ºä¿è­·ä½å®¿å“è³ªåŸå‰‡ï¼Œå¦‚æœæœ‰ä»¥ä¸‹ç‹€æ³å¾ˆæŠ±æ­‰æˆ‘å€‘ç„¡æ³•æä¾›ä½å®¿æœå‹™å”·ï¼</p>
                                <div class="grid grid-cols-1 gap-2.5">
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> ç„¡æ³•å‡ºç¤ºé é˜²é‡è­‰æ˜ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> èº«ä¸Šæœ‰è·³èš¤ã€å£è¨ç‹€æ³ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> ç›®å‰æœ‰çš®è†šç‹€æ³æˆ–å‚³æŸ“æ€§ç–¾ç—…ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> æœ‰æ”»æ“Šæ€§ã€ç ´å£è¡Œç‚ºã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> åˆ†é›¢ç„¦æ…®ã€ç’°å¢ƒç„¦æ…®ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> å®‰å®šæ€§å·®å å«ä¸æ­¢ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> æ­£åœ¨ç™¼æƒ…æˆ–æ‡·å­•ä¸­ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> æ‰‹è¡“å¾Œå‚·å£ç¸«ç·šæœªç—Šç™’ã€‚
                                    </div>
                                    <div class="flex items-center gap-3 text-xs text-red-700/80 font-bold">
                                        <i data-lucide="x-circle" class="w-4 h-4 text-red-400"></i> ç¶“éè©•ä¼°ç„¡æ³•å¦¥å–„ç…§é¡§ä¹‹ç‹€æ³ã€‚
                                    </div>
                                </div>
                                <div class="bg-white/80 p-4 rounded-xl border border-red-100 text-[10px] text-red-600 leading-relaxed">
                                    ä»¥ä¸Šå„é …ä¹‹æƒ…äº‹ï¼Œå¦‚é‡é£¼ä¸»æœªæ˜ç¢ºå‘ŠçŸ¥å°è‡´ä½å®¿çŠ¬éš»å—æœ‰å¥åº·ä¸Šä¹‹æå®³æˆ–ç”Ÿå‘½ä¹‹å±éšªæ™‚ï¼Œæœ¬å¯µç‰©æ—…é¤¨å‡ä¸è² ä»»ä½•è³ å„Ÿç¾©å‹™æˆ–é†«ç™‚è²»ç”¨ä¹‹è² æ“”ã€‚è‹¥å› æ­¤é€ æˆæ—…é¤¨ç’°å¢ƒæå£æˆ–ç›¸é—œç…§é¡§äººå“¡å—å‚·æˆ–ä»–äººçŠ¬éš»å¥åº·ä¸Šä¹‹æå®³æˆ–ç”Ÿå‘½å±éšªå‰‡éœ€ä»˜è³ å„Ÿä¹‹è²¬ä»»ã€‚
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
                </div>

                <div class="glass-panel p-6 rounded-2xl relative">
                    <div class="flex items-center gap-2 mb-6 border-b border-theme-sub/20 pb-3">
                        <span class="text-2xl">ğŸ“</span>
                        <h3 class="font-bold text-theme-text text-lg">æ³•å¾‹æ¢æ¬¾èˆ‡æ•¸ä½ç°½ç½²</h3>
                    </div>

                    <div class="bg-theme-bg/50 rounded-xl p-4 mb-6 space-y-3 border border-theme-sub/10">
                        <h4 class="text-xs font-bold text-theme-sub tracking-widest uppercase mb-2">ä¹™æ–¹ï¼ˆåº—å®¶ï¼‰è³‡è¨Š</h4>
                        <div class="grid grid-cols-2 gap-y-2 text-sm">
                            <div><span class="text-theme-sub text-xs block">åº—å®¶åç¨±</span><span class="font-bold text-theme-text">å¤§æŸ´å°ç†Šå¯µç‰©ç¾å®¹</span></div>
                            <div><span class="text-theme-sub text-xs block">è² è²¬äºº</span><span class="font-bold text-theme-text">é™³äºçª</span></div>
                            <div><span class="text-theme-sub text-xs block">ç‰¹å¯µæ¥­å­—è™Ÿ</span><span class="font-bold text-theme-text">S1130033 è™Ÿ</span></div>
                            <div><span class="text-theme-sub text-xs block">çµ±ä¸€ç·¨è™Ÿ</span><span class="font-bold text-theme-text">94536765</span></div>
                            <div><span class="text-theme-sub text-xs block">è¯çµ¡é›»è©±</span><span class="font-bold text-theme-text">0981-681-349</span></div>
                            <div><span class="text-theme-sub text-xs block">ç‡Ÿæ¥­æ™‚é–“</span><span class="font-bold text-theme-text">10:00-19:00</span></div>
                            <div class="col-span-2"><span class="text-theme-sub text-xs block">ç‡Ÿæ¥­åœ°å€</span><span class="font-bold text-theme-text">è‡ºä¸­å¸‚åŒ—å±¯å€å¹³å¾·è·¯82å··5è™Ÿ</span></div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label id="terms-label" class="block text-xs font-bold text-theme-sub mb-2 ml-1">ã€æœå‹™å¥‘ç´„æ¢æ¬¾ã€‘</label>
                        <button type="button" onclick="showTerms()" class="w-full flex items-center justify-between bg-white border border-theme-sub/30 rounded-xl p-4 group hover:border-theme-primary transition">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-theme-primary/10 flex items-center justify-center text-theme-primary">
                                    <i data-lucide="book-open" class="w-5 h-5"></i>
                                </div>
                                <span id="terms-btn-text" class="font-bold text-theme-text">é»æ“Šé–±è®€ç¾å®¹æ¢æ¬¾</span>
                            </div>
<span id="terms-status-badge" class="text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded">å¾…é–±è®€</span>
                        </button>
                    </div>

<div>
<div class="flex items-center gap-2 mb-2 ml-1">
    <label class="text-xs font-bold text-theme-sub">æ•¸ä½ç°½å</label>
    <span id="signature-lock-tip"
          class="text-[10px] font-bold text-red-500 bg-red-50 px-2 py-0.5 rounded">
        è«‹å…ˆé–±è®€æ¢æ¬¾ä»¥è§£é–ç°½å
    </span>
</div>

<div id="signature-box" onclick="openSignatureModal()"
     class="relative w-full h-32 bg-white border-2 border-dashed border-theme-sub/30 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-theme-primary hover:bg-theme-bg/30 transition group  opacity-60 pointer-events-none">

    <img id="signature-preview" class="absolute inset-0 w-full h-full object-contain p-2 hidden z-10">
    <div id="signature-placeholder" class="flex flex-col items-center gap-2 text-theme-sub/50 group-hover:text-theme-primary/70 transition">
        <i data-lucide="pen-tool" class="w-6 h-6"></i>
        <span class="text-xs font-bold">é»æ“Šé–‹å•Ÿå…¨è¢å¹•ç°½åæ¿</span>
    </div>
</div>

<div id="signature-status" class="hidden mt-3 flex items-center justify-end gap-3">
    <span class="bg-theme-primary/10 text-theme-dark px-3 py-1.5 rounded-full text-[11px] font-bold flex items-center gap-1 border border-theme-primary/30">
        <i data-lucide="check-circle" class="w-4 h-4"></i> å·²ç°½ç½²
    </span>
    <span id="signature-time" class="text-[11px] text-theme-sub font-bold"></span>
</div>
</div>

<!-- é€™ä¸‰å€‹æ˜¯å„²å­˜ä¸Šå‚³çµæœ -->
<input type="hidden" id="signature_url" name="signature_url">
<input type="hidden" id="pet_photo_url" name="pet_photo_url">
<input type="hidden" id="vaccine_photo_url" name="vaccine_photo_url">
</div>

                <div class="flex gap-3 pt-4">
<button type="button" id="submit-btn" onclick="handleSubmit()"
 class="flex-1 py-3 rounded-xl bg-gradient-lux text-white font-bold text-sm shadow-lg hover:shadow-glow hover:-translate-y-0.5 transition-all">
    ç¢ºèªä¸¦æäº¤æ•¸ä½å¥‘ç´„
</button>
                </div>
            </form>
        </div>
<!-- âœ… æˆåŠŸé  (åŒä¸€é é¢) -->
<div id="view-success" class="hidden pb-20 pt-24">
  <div class="glass-panel rounded-[28px] p-8 text-center space-y-6">
    
    <div id="success-icon-wrap"
         class="mx-auto w-20 h-20 rounded-full flex items-center justify-center bg-theme-primary/10">
      <i id="success-icon" data-lucide="check" class="w-10 h-10 text-theme-dark"></i>
    </div>

    <h2 id="success-title" class="text-2xl font-black text-theme-text">æäº¤æˆåŠŸï¼</h2>

    <div id="success-box"
         class="rounded-2xl p-4 text-sm text-theme-text border border-theme-primary/30 bg-theme-bg/70 text-left">
      <!-- JS æœƒæ”¾å…§å®¹ -->
    </div>

    <button onclick="openSimpleContract()" 
      class="w-full py-4 rounded-2xl bg-gradient-lux text-white font-bold shadow-lg flex items-center justify-center gap-2">
      <i data-lucide="camera" class="w-4 h-4"></i> é–‹å•Ÿå®Œæ•´å¥‘ç´„ï¼ˆæˆªåœ–ä¿å­˜ï¼‰
    </button>

    <button onclick="backToHomeFromSuccess()" 
      class="w-full py-3 rounded-2xl bg-white border border-theme-primary/30 text-theme-text font-bold flex items-center justify-center gap-2">
      <i data-lucide="home" class="w-4 h-4"></i> è¿”å›é¦–é ï¼ˆå®Œæˆï¼‰
    </button>
  </div>
</div>
    </main>

<div id="modal-terms" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity" onclick="closeTerms()"></div>
<div class="relative w-full max-w-sm bg-white rounded-[32px] overflow-hidden max-h-[80vh] flex flex-col transition-all duration-300 transform scale-95 opacity-0" id="modal-content">
            <div class="p-4 border-b flex items-center justify-between">
                <div class="w-9"></div> <h3 id="modal-title" class="font-bold text-lg text-theme-text flex-1 text-center">å¥‘ç´„æ¢æ¬¾</h3>
<button onclick="closeTerms()" class="p-2 bg-gray-100 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
<div id="modal-body"
     class="p-6 overflow-y-auto text-sm text-theme-text leading-relaxed space-y-4 text-center"
     onscroll="checkTermsScroll(this)">
</div>

<div class="p-6 border-t border-theme-sub/10 bg-white/90 backdrop-blur-md safe-bottom">
    <div id="terms-scroll-tip" class="text-xs text-red-500 font-bold text-center mb-3 animate-pulse">
        ğŸ‘‡ è«‹æ»‘å‹•è‡³æœ€åº•éƒ¨ä»¥å•Ÿç”¨æŒ‰éˆ•
    </div>
    <button id="agree-btn" onclick="agreeTerms()" disabled
            class="w-full py-4 rounded-2xl font-bold shadow-glow transition-all active:scale-[0.98] tracking-[0.1em] bg-gray-200 text-gray-400 cursor-not-allowed">
        è«‹é–±è®€å®Œç•¢
    </button>
</div>
        </div>
    </div>

    <div id="modal-signature" class="fixed inset-0 z-[200] bg-white hidden flex-col">
        <div class="flex items-center justify-between p-4 border-b bg-gray-50">
            <h3 class="font-bold text-theme-text">è«‹åœ¨æ­¤å€åŸŸç°½å</h3>
            <button type="button" onclick="closeSignatureModal()" class="p-2 bg-gray-200 rounded-full">
                <i data-lucide="x" class="w-5 h-5 text-gray-600"></i>
            </button>
        </div>
        
        <div class="flex-1 relative bg-gray-100 touch-none overflow-hidden" id="canvas-container">
            <canvas id="sig-canvas" class="absolute inset-0 w-full h-full bg-white cursor-crosshair"></canvas>
            <div class="absolute bottom-4 left-0 w-full text-center pointer-events-none opacity-20 text-4xl font-black text-gray-300 select-none">
                SIGN HERE
            </div>
        </div>

        <div class="p-4 border-t bg-white flex gap-3 safe-bottom">
            <button type="button" onclick="clearSignature()" class="flex-1 py-3 rounded-xl border border-red-200 text-red-500 font-bold hover:bg-red-50">
                æ¸…é™¤é‡å¯«
            </button>
            <button type="button" onclick="saveSignature()" class="flex-[2] py-3 rounded-xl bg-theme-primary text-white font-bold shadow-lg">
                ç¢ºèªç°½å
            </button>
        </div>
    </div>

<script>
// âœ… é€å‡ºæ™‚æ‰å£“ç¸®èˆ‡ä¸Šå‚³ç”¨çš„æš«å­˜è®Šæ•¸
let petPhotoFile = null;
let vaccinePhotoFile = null;
let signatureDataUrl = null;
let isSubmitting = false;
/* ===== Supabase åˆå§‹åŒ–ï¼ˆè«‹æ•´æ®µæ›¿æ›ï¼‰ ===== */
const SUPABASE_URL = "https://vmjczgepqlefbsfarogk.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZtamN6Z2VwcWxlZmJzZmFyb2drIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODI2OTIsImV4cCI6MjA4NTk1ODY5Mn0.7C2vDebLan_VzQnC9QSkE2WAwXHKDpN3onydHFUceiY";
const BUCKET = "temp_file_99b96a23-483e-4ae9-953c-f304f6182f4e";

let supabaseClient = null;
// Logo é›™æ“Šé€²å¾Œå°
// å¿…é ˆå¾ window.supabase å–å¾— createClient
if (window.supabase && typeof window.supabase.createClient === "function") {
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.supabaseClient = supabaseClient;
} else {
    alert("Supabase SDK æ²’æœ‰è¼‰å…¥æˆåŠŸï¼Œè«‹ç¢ºèª <script src='https://cdn.jsdelivr.net/...supabase.js'> æ˜¯å¦æ­£ç¢º");
}

if (!supabaseClient || !supabaseClient.storage || typeof supabaseClient.storage.from !== "function") {
    alert("Supabase Storage æ²’æœ‰åˆå§‹åŒ–æˆåŠŸï¼Œè«‹é‡æ–°æ•´ç†");
}

let oldCustomerPets = {};
let currentSelectedPet = null;

// âœ… æœå°‹é›»è©±
async function searchOldCustomer() {
    const phone = document.getElementById("phone").value.trim();
    if (!phone) return alert("è«‹å…ˆè¼¸å…¥é›»è©±");

    const { data, error } = await supabaseClient
        .rpc("search_old_customers", { p_phone: phone });

    if (error || !data || data.length === 0) {
        alert("æ‰¾ä¸åˆ°èˆŠå®¢ç´€éŒ„");
        return;
    }

    oldCustomerPets = {};
    data.forEach(r => {
        const d = typeof r.data === "string" ? JSON.parse(r.data) : r.data;
        const pet = d.pet_name || "æœªå‘½å";
        if (!oldCustomerPets[pet]) {
            oldCustomerPets[pet] = { pet_name: pet, records: [] };
        }
        oldCustomerPets[pet].records.push({ ...r, data: d });
    });

    renderPetList();
    document.getElementById("old-modal-1").classList.remove("hidden");
    document.getElementById("old-modal-1").classList.add("flex");
}

function renderPetList() {
    const list = document.getElementById("old-pet-list");
    list.innerHTML = "";
    Object.values(oldCustomerPets).forEach(petGroup => {
        const hasGroom = petGroup.records.some(r => r.type === "grooming");
        const hasBoard = petGroup.records.some(r => r.type === "boarding");

        const btn = document.createElement("button");
        btn.className = "w-full text-left p-4 rounded-xl border hover:border-theme-primary transition flex items-center gap-3";
        btn.innerHTML = `
            <div class="w-10 h-10 rounded-full bg-theme-primary/20 text-theme-text font-bold flex items-center justify-center">
              ${petGroup.pet_name[0] || "ğŸ¾"}
            </div>
            <div class="flex-1">
              <div class="font-bold">${petGroup.pet_name}</div>
              <div class="text-xs text-gray-500">${hasGroom ? "æœ‰ç¾å®¹ç´€éŒ„" : ""} ${hasBoard ? "æœ‰ä½å®¿ç´€éŒ„" : ""}</div>
            </div>
            <span class="text-theme-sub">â€º</span>
        `;
        btn.onclick = () => openRecordModal(petGroup);
        list.appendChild(btn);
    });
}

function openRecordModal(petGroup) {
    currentSelectedPet = petGroup;
    document.getElementById("old-modal-1").classList.add("hidden");
    document.getElementById("old-modal-2").classList.remove("hidden");
    document.getElementById("old-modal-2").classList.add("flex");
    document.getElementById("old-modal-title").innerText = `é¸æ“‡ ${petGroup.pet_name} çš„ç´€éŒ„`;

    const list = document.getElementById("old-record-list");
    list.innerHTML = "";

    const latestG = petGroup.records.find(r => r.type === "grooming");
    const latestB = petGroup.records.find(r => r.type === "boarding");

    if (latestG) {
        list.innerHTML += `
            <button onclick="applyOldCustomer('grooming')" 
              class="w-full p-4 rounded-xl border border-blue-200 bg-blue-50 text-left">
              âœ‚ï¸ å¸¶å…¥ã€ç¾å®¹ã€‘è³‡æ–™
              <div class="text-xs text-blue-500">ä¸Šæ¬¡ï¼š${new Date(latestG.created_at).toLocaleDateString()}</div>
            </button>`;
    }
    if (latestB) {
        list.innerHTML += `
            <button onclick="applyOldCustomer('boarding')" 
              class="w-full p-4 rounded-xl border border-orange-200 bg-orange-50 text-left">
              ğŸ  å¸¶å…¥ã€ä½å®¿ã€‘è³‡æ–™
              <div class="text-xs text-orange-500">ä¸Šæ¬¡ï¼š${new Date(latestB.created_at).toLocaleDateString()}</div>
            </button>`;
    }
}

function closeOldModal() {
    document.getElementById("old-modal-1").classList.add("hidden");
    document.getElementById("old-modal-2").classList.add("hidden");
}

function applyOwnerOnly() {
    if (!Object.values(oldCustomerPets).length) return;
    const latest = Object.values(oldCustomerPets)[0].records[0];
    fillOwnerFields(latest.data);
    closeOldModal();
}

function applyOldCustomer(type) {
    if (!currentSelectedPet) return;
    const rec = currentSelectedPet.records.find(r => r.type === type);
    if (!rec) return;

    fillOwnerFields(rec.data);
    fillPetFields(rec.data);
    if (type === "boarding") fillBoardingFields(rec.data);

    closeOldModal();
}

/* === æ¬„ä½å¸¶å…¥ === */
function fillOwnerFields(data) {
    ["owner_name","email","phone","id_number","address","emergency_contact","emergency_phone"]
    .forEach(k => setField(k, data[k]));
}

function fillPetFields(data) {
    const map = normalizeData(data);
    ["pet_type","pet_name","pet_breed","pet_weight","pet_birthday","pet_age",
     "gender","neuter","microchip_status","microchip_number",
     "aggression","dog_social","temperament","history_check","history_detail","specified_hospital"
    ].forEach(k => setField(k, map[k]));
}

function fillBoardingFields(data) {
    const map = normalizeData(data);
    ["social_note","deworming","deworming_brand","barking","barking_note",
     "food_guard","food_guard_note","toilet","toilet_note","vaccine","boarding_note"]
    .forEach(k => setField(k, map[k]));
}

function setField(key, val) {
    if (val === undefined || val === null) return;

    // åªæŠ“ radio / checkbox
    const radios = document.querySelectorAll(
        `[name="${key}"][type="radio"], [name="${key}"][type="checkbox"]`
    );

    if (radios.length) {
        radios.forEach(r => {
            if (r.type === "radio") r.checked = (r.value == val);
            if (r.type === "checkbox") {
                r.checked = Array.isArray(val) ? val.includes(r.value) : (val === r.value);
            }
            if (r.checked) r.dispatchEvent(new Event("change"));
        });
        return;
    }

    // å…¶ä»–æ¬„ä½ç”¨ id æˆ– name å¡«å…¥
    const el = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
    if (el) {
        el.value = val;
        el.dispatchEvent(new Event("input"));
        el.dispatchEvent(new Event("change"));
    }
}

function normalizeData(d) {
    const map = {...d};
    const dict = {
        pet_type: { dog:"ç‹—ç‹—", cat:"è²“å’ª" },
        gender: { m:"å…¬", f:"æ¯" },
        neuter: { yes:"å·²çµç´®", no:"æœªçµç´®" },
        microchip_status: { yes:"æœ‰æ™¶ç‰‡", no:"ç„¡æ™¶ç‰‡", unknown:"æœ‰æ™¶ç‰‡è™Ÿç¢¼ä¸è©³" },
        vaccine: { yes:"æœ‰å®šæœŸæ‰“ç–«è‹—", no:"æ²’æœ‰å®šæœŸæ‰“ç–«è‹—" },
        deworming: { yes:"æœ‰å®šæœŸé©…èŸ²", no:"ç„¡å®šæœŸé©…èŸ²" },
        barking: { yes:"æ˜“å å«", no:"ä¸æ˜“å å«" },
        food_guard: { yes:"æœƒè­·é£Ÿ", no:"ä¸æœƒè­·é£Ÿ" },
        toilet: { yes:"æœƒç”¨å°¿å¸ƒå¢Š", no:"ä¸æœƒç”¨å°¿å¸ƒå¢Š" }
    };
    for (let k in dict) if (map[k] in dict[k]) map[k] = dict[k][map[k]];
    return map;
}

async function uploadToSupabase(path, blob, contentType) {
    if (!supabaseClient || !supabaseClient.storage || typeof supabaseClient.storage.from !== "function") {
        alert("Supabase Storage å°šæœªåˆå§‹åŒ–ï¼Œè«‹é‡æ–°æ•´ç†é é¢");
        return null;
    }

    const { data, error } = await supabaseClient.storage
        .from(BUCKET)
        .upload(path, blob, { contentType, upsert: true });

    if (error) {
        console.error("ä¸Šå‚³å¤±æ•—", error);
        alert("ä¸Šå‚³å¤±æ•—ï¼š" + error.message);
        return null;
    }

    const { data: publicData } = supabaseClient.storage
        .from(BUCKET)
        .getPublicUrl(path);

    return publicData.publicUrl;
}

    function compressImage(file, maxWidth = 1280, quality = 0.7) {
        return new Promise(resolve => {
            const img = new Image();
            img.onload = () => {
                const scale = Math.min(maxWidth / img.width, 1);
                const w = img.width * scale;
                const h = img.height * scale;
                const canvas = document.createElement('canvas');
                canvas.width = w;
                canvas.height = h;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, w, h);
                canvas.toBlob(blob => resolve(blob), 'image/jpeg', quality);
            };
            img.src = URL.createObjectURL(file);
        });
    }
let termsRead = { grooming: false, boarding: false };

function isTermsReady() {
    return currentType === 'grooming' ? termsRead.grooming : termsRead.boarding;
}

function updateSignatureLock() {
    const box = document.getElementById('signature-box');
    const tip = document.getElementById('signature-lock-tip');

    if (isTermsReady()) {
        box.classList.remove('opacity-60', 'pointer-events-none');
        tip.classList.add('hidden');
    } else {
        box.classList.add('opacity-60', 'pointer-events-none');
        tip.classList.remove('hidden');
    }
}
async function handleSubmit() {
    // âœ… å…ˆåŒæ­¥å¿…å¡«ç‹€æ…‹
    updateBaseRequired();
    updateAgeRequired();
    updateBoardingRequired();

    const form = document.getElementById('main-form');
if (!form.checkValidity()) {
  form.reportValidity();  // ç›´æ¥é¡¯ç¤ºç€è¦½å™¨åŸç”Ÿæ³¡æ³¡
  return;
}

    // âœ… è‡ªè¨‚æª¢æŸ¥
    if (!petPhotoFile) {
        alert("è«‹ä¸Šå‚³å¯µç‰©å…¨èº«ç…§");
        return;
    }
    if (currentType === 'boarding' && !vaccinePhotoFile) {
        alert("è«‹ä¸Šå‚³ç–«è‹—ç…§ç‰‡");
        return;
    }
    if (currentType === 'grooming' && !document.querySelector('input[name="service"]:checked')) {
        alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …ç¾å®¹æœå‹™");
        return;
    }

    const mattingChecked = document.querySelector('input[name="matting_suspected"]');
    if (mattingChecked && mattingChecked.checked && !document.querySelector('input[name="matting_choice"]:checked')) {
        alert("è«‹é¸æ“‡æ‰“çµè™•ç†æ–¹å¼");
        return;
    }

    if (isSubmitting) return;

    if (!isTermsReady()) {
        alert("è«‹å…ˆé–±è®€æ¢æ¬¾");
        return;
    }
    if (!signatureDataUrl) {
        alert("è«‹å…ˆå®Œæˆç°½å");
        return;
    }


    // ğŸ”’ é–å®šæŒ‰éˆ•
    isSubmitting = true;
    const btn = document.getElementById("submit-btn");
    btn.disabled = true;
    btn.classList.add("opacity-60", "pointer-events-none");
    btn.innerText = "ä¸Šå‚³ä¸­ï¼Œè«‹ç¨å€™...";

    try {
        // 1. ä¸Šå‚³ç°½å
        const sigBlob = dataURLtoBlob(signatureDataUrl);
        const sigPath = `signatures/${Date.now()}.png`;
        const signatureUrl = await uploadToSupabase(sigPath, sigBlob, "image/png");
        if (!signatureUrl) throw new Error("ç°½åä¸Šå‚³å¤±æ•—");

        // 2. ä¸Šå‚³å¯µç‰©ç…§ç‰‡
        let petUrl = "";
        if (petPhotoFile) {
            const compressedPet = await compressImage(petPhotoFile, 1280, 0.7);
            petUrl = await uploadToSupabase(`pet_photos/${Date.now()}.jpg`, compressedPet, "image/jpeg");
        }

        // 3. ä¸Šå‚³ç–«è‹—ç…§ç‰‡
        let vaccineUrl = "";
        if (vaccinePhotoFile) {
            const compressedVac = await compressImage(vaccinePhotoFile, 1280, 0.7);
            vaccineUrl = await uploadToSupabase(`vaccine/${Date.now()}.jpg`, compressedVac, "image/jpeg");
        }

        // å¡«å› hidden æ¬„ä½
        document.getElementById("signature_url").value = signatureUrl || "";
        document.getElementById("pet_photo_url").value = petUrl || "";
        document.getElementById("vaccine_photo_url").value = vaccineUrl || "";

        // åŸæœ¬é€å‡ºé‚è¼¯
        const form = document.getElementById('main-form');
        const fd = new FormData(form);
        const data = {};
        for (const [key, value] of fd.entries()) {
            if (data[key]) {
                if (!Array.isArray(data[key])) data[key] = [data[key]];
                data[key].push(value);
            } else {
                data[key] = value;
            }
        }

        if (currentType === "grooming") {
            delete data.checkin_date;
            delete data.checkout_date;
            delete data.daycare_date;
            delete data.arrive_time;
            delete data.leave_time;
            delete data.social_note;
            delete data.deworming;
            delete data.deworming_brand;
            delete data.barking;
            delete data.barking_note;
            delete data.food_guard;
            delete data.food_guard_note;
            delete data.toilet;
            delete data.toilet_note;
            delete data.vaccine;
            delete data.boarding_note;
        }

        if (currentType === "boarding") {
            delete data.service;
            delete data.upgrade_service;
            delete data.matting_suspected;
            delete data.matting_choice;
            delete data.other_service_text;
        }
        if (!data.specified_hospital || !data.specified_hospital.trim()) {
            data.specified_hospital = "ä¾åº—å®¶æŒ‡å®š";
        }
        const payload = {
            type: currentType,
            data,
            signature_url: signatureUrl,
            pet_photo_url: petUrl,
            vaccine_photo_url: vaccineUrl
        };

        const { error } = await supabaseClient.from("contracts").insert([payload]);

        if (error) throw error;

const contractData = {
    type: currentType,
    data,
    signature_url: signatureUrl,
    pet_photo_url: petUrl,
    vaccine_photo_url: vaccineUrl,
    created_at: new Date().toISOString(),
    signed_at: signatureTime ? signatureTime.toISOString() : new Date().toISOString()
};

const hasEmail = (data.email || "").trim() !== "";

// âœ… å¦‚æœæœ‰å¡« emailï¼Œå°±å¯„å‡ºå‰¯æœ¬
if (hasEmail) {
    const html = generateContractHTML(contractData);

    await fetch("https://vmjczgepqlefbsfarogk.supabase.co/functions/v1/resend-email", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            apikey: SUPABASE_ANON_KEY,
            Authorization: `Bearer ${SUPABASE_ANON_KEY}`
        },
body: JSON.stringify({
    to: data.email,
    html,
    petNames: data.pet_name || "æ¯›å­©"
})
    });
}

showSuccessPage(contractData, hasEmail);
return;
    } catch (err) {
        console.error(err);
        alert("âŒ æäº¤å¤±æ•—ï¼š" + (err.message || err));
    } finally {
        // é‚„åŸæŒ‰éˆ•
        isSubmitting = false;
        btn.disabled = false;
        btn.classList.remove("opacity-60", "pointer-events-none");
        btn.innerText = "ç¢ºèªä¸¦æäº¤æ•¸ä½å¥‘ç´„";
    }
}
window.addEventListener('load', () => {
  const logo = document.getElementById('home-logo');
  if (!logo) return;

  // é›»è…¦é›™æ“Š
  logo.addEventListener('dblclick', () => {
    window.location.href = "admin.html";
  });

  // æ‰‹æ©Ÿé›™é»
  let lastTap = 0;
  logo.addEventListener('touchend', () => {
    const now = Date.now();
    if (now - lastTap < 400) {
      window.location.href = "admin.html";
    }
    lastTap = now;
  });
});

window.addEventListener('load', () => {
    const id = document.getElementById('id_number');
    const phone = document.getElementById('phone');
    const emergency = document.getElementById('emergency_phone');

    if (id) {
        id.addEventListener('input', () => {
            if (!/^[A-Z][12][0-9]{8}$/.test(id.value)) {
                id.setCustomValidity("èº«åˆ†è­‰æ ¼å¼éŒ¯èª¤")
            } else {
                id.setCustomValidity("");
            }
        });
    }

    if (phone) {
        phone.addEventListener('input', () => {
            if (!/^09\d{8}$/.test(phone.value)) {
                phone.setCustomValidity("é›»è©±æ ¼å¼éœ€ç‚º 09 é–‹é ­ + 8ä½æ•¸å­—");
            } else {
                phone.setCustomValidity("");
            }
        });
    }

    if (emergency) {
        emergency.addEventListener('input', () => {
            if (!/^09\d{8}$/.test(emergency.value)) {
                emergency.setCustomValidity("é›»è©±æ ¼å¼éœ€ç‚º 09 é–‹é ­ + 8ä½æ•¸å­—");
            } else {
                emergency.setCustomValidity("");
            }
        });
    }
});

window.addEventListener('load', () => {    
  document.querySelectorAll('#main-form input, #main-form select, #main-form textarea')
    .forEach(el => {
      if (!el.name && el.id) el.name = el.id;
    });
});
function agreeTerms() {
    if (currentType === 'grooming') termsRead.grooming = true;
    else termsRead.boarding = true;

    // è®Šæ›´æŒ‰éˆ•æ–‡å­—èˆ‡ç‹€æ…‹
    document.getElementById('terms-btn-text').innerText = 
        currentType === 'grooming' ? 'ç¾å®¹æ¢æ¬¾å·²é–±è®€' : 'ä½å®¿æ¢æ¬¾å·²é–±è®€';

    const badge = document.getElementById('terms-status-badge');
    badge.innerText = 'å·²å®Œæˆ';
    badge.className = 'text-xs font-bold bg-theme-primary text-white px-2 py-1 rounded';

    updateSignatureLock();
    closeTerms();
}
// âœ… å¿…å¡«æ§åˆ¶å·¥å…·
function setRequiredById(id, required) {
    const el = document.getElementById(id);
    if (el) el.required = required;
}
function setRequiredByName(name, required) {
    const els = document.querySelectorAll(`[name="${name}"]`);
    els.forEach(el => { el.required = required; });
}

// âœ… å…±é€šå¿…å¡«ï¼ˆç¾å®¹ï¼‹ä½å®¿éƒ½è¦ï¼‰
function updateBaseRequired() {
    setRequiredByName('pet_type', true);
    setRequiredByName('gender', true);
    setRequiredByName('neuter', true);
    setRequiredByName('microchip_status', true);
    setRequiredByName('aggression', true);
    setRequiredByName('dog_social', true);
    setRequiredByName('temperament', true);
    setRequiredByName('history_check', true);

    // å¯µç‰©ç…§ç‰‡ä¸€å®šè¦
    setRequiredById('pet_photo_file', true);
}
// âœ… ç”Ÿæ—¥ / å¹´é½¡å¿…å¡«æ§åˆ¶
function updateAgeRequired() {
    const birthdayVisible = !document.getElementById('input-birthday').classList.contains('hidden');
    if (birthdayVisible) {
        setRequiredById('pet_birthday', true);
        setRequiredById('pet_age', false);
    } else {
        setRequiredById('pet_birthday', false);
        setRequiredById('pet_age', true);
    }
}

// âœ… ä½å®¿/å®‰è¦ªå¿…å¡«æ§åˆ¶
function updateBoardingRequired() {
    const isBoarding = currentType === 'boarding';

    // ä½å®¿æ‰å¿…å¡«çš„ radio ç¾¤çµ„
    ['deworming','barking','food_guard','toilet','vaccine'].forEach(name => {
        setRequiredByName(name, isBoarding);
    });

    // ç–«è‹—ç…§ç‰‡åªåœ¨ä½å®¿å¿…å¡«
    setRequiredById('vaccine_photo_file', isBoarding);

    if (!isBoarding) {
        setRequiredById('checkin_date', false);
        setRequiredById('checkout_date', false);
        setRequiredById('daycare_date', false);
        return;
    }

    const overnightVisible = !document.getElementById('date-section-overnight').classList.contains('hidden');
    if (overnightVisible) {
        setRequiredById('checkin_date', true);
        setRequiredById('checkout_date', true);
        setRequiredById('daycare_date', false);
    } else {
        setRequiredById('checkin_date', false);
        setRequiredById('checkout_date', false);
        setRequiredById('daycare_date', true);
    }
}
// âœ… æ™¶ç‰‡è™Ÿç¢¼ï¼šåªæœ‰é¸ã€Œæœ‰æ™¶ç‰‡ã€æ‰å¿…å¡«
document.querySelectorAll('input[name="microchip_status"]').forEach(radio => {
    radio.addEventListener('change', () => {
        const chipInput = document.getElementById('microchip_number');
        if (!chipInput) return;
        chipInput.required = (radio.value === 'æœ‰æ™¶ç‰‡');
    });
});
// âœ… ç—…å²è©³è¿°ï¼šåªæœ‰é¸ã€Œæœ‰ç—…å²ã€æ‰å¿…å¡«
document.querySelectorAll('input[name="history_check"]').forEach(radio => {
    radio.addEventListener('change', () => {
        const history = document.getElementById('history_detail');
        if (!history) return;
        history.required = (radio.value === 'æœ‰ç—…å²');
    });
});
// âœ… é€€æˆ¿æ—¥æœŸä¸èƒ½æ—©æ–¼å…¥ä½æ—¥æœŸ
const checkin = document.getElementById('checkin_date');
const checkout = document.getElementById('checkout_date');

function validateDateRange() {
    if (checkout.value && checkin.value && checkout.value < checkin.value) {
        checkout.setCustomValidity("é€€æˆ¿æ—¥æœŸä¸èƒ½æ—©æ–¼å…¥ä½æ—¥æœŸ");
    } else {
        checkout.setCustomValidity("");
    }
}

if (checkin && checkout) {
    checkin.addEventListener('change', validateDateRange);
    checkout.addEventListener('change', validateDateRange);
}
    lucide.createIcons();        
        // 1. è·¯ç”±è™•ç†
        window.addEventListener('load', handleHashChange);
        window.addEventListener('hashchange', handleHashChange);

        let currentType = 'grooming'; 

        function handleHashChange() {
            const hash = window.location.hash;
            if (hash === '#grooming') showPage('form', 'grooming');
            else if (hash === '#boarding') showPage('form', 'boarding');
            else showPage('home');
            updateSignatureLock();
            document.getElementById('view-success')?.classList.add('hidden');


        }

        function router(page, type) {
            if (page === 'home') window.location.hash = 'home';
            else if (page === 'form') window.location.hash = type;
        }

        function showPage(page, type) {
            const home = document.getElementById('view-home');
            const form = document.getElementById('view-form');
            const navbar = document.getElementById('navbar');
            const formTitle = document.getElementById('form-title');
            const formIcon = document.getElementById('form-icon');
            const sectionGrooming = document.getElementById('section-grooming');
            const sectionBoarding = document.getElementById('section-boarding');
            const termsLabel = document.getElementById('terms-label');
            const termsBtnText = document.getElementById('terms-btn-text');

            window.scrollTo({top: 0, behavior: 'smooth'});

            if (page === 'form') {
                home.style.display = 'none';
                form.classList.remove('hidden');
                navbar.classList.remove('opacity-0', 'pointer-events-none');
                
                currentType = type; 

                if(type === 'grooming') {
                    formTitle.innerText = "å¯µç‰©ç¾å®¹å¥‘ç´„æ›¸";
                    formIcon.setAttribute('data-lucide', 'scissors');
                    sectionGrooming.classList.remove('hidden');
                    sectionBoarding.classList.add('hidden');
                    termsLabel.innerText = "ã€çŠ¬ã€è²“ç¾å®¹å¥‘ç´„æ¢æ¬¾ã€‘";
                    termsBtnText.innerText = "é»æ“Šé–±è®€ç¾å®¹æ¢æ¬¾";
                } else if (type === 'boarding') {
                    formTitle.innerText = "å¯µç‰©ä½å®¿å¥‘ç´„æ›¸";
                    formIcon.setAttribute('data-lucide', 'home');
                    sectionGrooming.classList.add('hidden');
                    sectionBoarding.classList.remove('hidden');
                    termsLabel.innerText = "ã€å¯µç‰©ä½å®¿å¥‘ç´„æ¢æ¬¾ã€‘";
                    termsBtnText.innerText = "é»æ“Šé–±è®€ä½å®¿æ¢æ¬¾";
                }
                lucide.createIcons();

                // é€™æ®µæœƒæ›´æ–°ã€Œå¾…é–±è®€ / å·²å®Œæˆã€
                const badge = document.getElementById('terms-status-badge');
                if (currentType === 'grooming' && termsRead.grooming) {
                    badge.innerText = 'å·²å®Œæˆ';
                    badge.className = 'text-xs font-bold bg-theme-primary text-white px-2 py-1 rounded';
                } else if (currentType === 'boarding' && termsRead.boarding) {
                    badge.innerText = 'å·²å®Œæˆ';
                    badge.className = 'text-xs font-bold bg-theme-primary text-white px-2 py-1 rounded';
                } else {
                    badge.innerText = 'å¾…é–±è®€';
                    badge.className = 'text-xs font-bold text-red-500 bg-red-50 px-2 py-1 rounded';
                }

// âœ… é€²å…¥é é¢æ™‚åŒæ­¥å¿…å¡«
updateBaseRequired();
updateAgeRequired();
updateBoardingRequired();

            } else {
                form.classList.add('hidden');
                home.style.display = 'flex';
                navbar.classList.add('opacity-0', 'pointer-events-none');
            }
        }
// åˆ‡æ›å¯µç‰©å¹´é½¡/ç”Ÿæ—¥è¼¸å…¥æ¨¡å¼
function toggleAgeInput(type) {
    const btnBirthday = document.getElementById('tab-birthday');
    const btnAge = document.getElementById('tab-age');
    const inputBirthday = document.getElementById('input-birthday');
    const inputAge = document.getElementById('input-age');

    const activeClass = ['bg-white', 'text-theme-primary', 'shadow-sm'];
    const inactiveClass = ['text-theme-sub'];

    if (type === 'birthday') {
        btnBirthday.classList.add(...activeClass);
        btnBirthday.classList.remove(...inactiveClass);
        btnAge.classList.remove(...activeClass);
        btnAge.classList.add(...inactiveClass);
        inputBirthday.classList.remove('hidden');
        inputAge.classList.add('hidden');
    } else {
        btnAge.classList.add(...activeClass);
        btnAge.classList.remove(...inactiveClass);
        btnBirthday.classList.remove(...activeClass);
        btnBirthday.classList.add(...inactiveClass);
        inputAge.classList.remove('hidden');
        inputBirthday.classList.add('hidden');
    }

    // âœ… åŒæ­¥å¿…å¡«
    updateAgeRequired();
}

// 2. ä½å®¿/å®‰è¦ª Tab åˆ‡æ›
function toggleBoardingType(type) {
    const btnOvernight = document.getElementById('tab-overnight');
    const btnDaycare = document.getElementById('tab-daycare');
    const secOvernight = document.getElementById('date-section-overnight');
    const secDaycare = document.getElementById('date-section-daycare');

    const activeClass = ['bg-white', 'text-theme-primary', 'shadow-sm'];
    const inactiveClass = ['text-theme-sub', 'hover:text-theme-text'];

    if (type === 'overnight') {
        btnOvernight.classList.add(...activeClass);
        btnOvernight.classList.remove(...inactiveClass);
        btnDaycare.classList.remove(...activeClass);
        btnDaycare.classList.add(...inactiveClass);

        secOvernight.classList.remove('hidden');
        secDaycare.classList.add('hidden');
    } else {
        btnDaycare.classList.add(...activeClass);
        btnDaycare.classList.remove(...inactiveClass);
        btnOvernight.classList.remove(...activeClass);
        btnOvernight.classList.add(...inactiveClass);

        secDaycare.classList.remove('hidden');
        secOvernight.classList.add('hidden');
    }

    // âœ… åŒæ­¥å¿…å¡«
    updateBoardingRequired();
}

        // è™•ç†æ‰“çµè©³æƒ…å±•é–‹
        function toggleMatting(label) {
            const checkbox = label.querySelector('input[name="matting_suspected"]');
            const details = document.getElementById('matting-details');
            const arrow = document.getElementById('matting-arrow');
            
            // ä½¿ç”¨ setTimeout ç¢ºä¿ checkbox ç‹€æ…‹å·²æ›´æ–°
            setTimeout(() => {
                if(checkbox.checked) {
                    details.classList.remove('hidden');
                    arrow.classList.add('rotate-180');
                    label.classList.add('border-theme-primary/50', 'bg-theme-primary/5');
                } else {
                    details.classList.add('hidden');
                    arrow.classList.remove('rotate-180');
                    label.classList.remove('border-theme-primary/50', 'bg-theme-primary/5');
                    // æ¸…é™¤å…§éƒ¨çš„ radio
                    document.querySelectorAll('input[name="matting_choice"]').forEach(r => r.checked = false);
                }
            }, 0);
        }


// 3. ç…§ç‰‡ä¸Šå‚³é è¦½
function previewImage(input) {
    if (input.files && input.files[0]) {
        vaccinePhotoFile = input.files[0];

        const textSpan = document.getElementById('upload-text');
        const previewImg = document.getElementById('vaccine-photo-preview');

        previewImg.src = URL.createObjectURL(input.files[0]);
        previewImg.classList.remove('hidden');

        textSpan.innerText = "âœ… å·²å®Œæˆ";
    }
}
        // å¯µç‰©å…¨èº«ç…§é è¦½
function previewPetPhoto(input) {
    if (input.files && input.files[0]) {
        petPhotoFile = input.files[0];

        const textSpan = document.getElementById('pet-photo-upload-text');
        const previewImg = document.getElementById('pet-photo-preview');

        previewImg.src = URL.createObjectURL(input.files[0]);
        previewImg.classList.remove('hidden');

        textSpan.innerText = "âœ… å·²å®Œæˆ";
    }
}
function dataURLtoBlob(dataURL) {
    const arr = dataURL.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while (n--) u8arr[n] = bstr.charCodeAt(n);
    return new Blob([u8arr], { type: mime });
}

let signatureTime = null;
        // 4. ç°½åæ¿åŠŸèƒ½
        let canvas, ctx, isDrawing = false;
        let signatureInitialized = false;
// âœ… Toast åŠŸèƒ½
function showToast(message, type = "info") {
    const toast = document.getElementById("toast");
    const text = document.getElementById("toast-text");
    if (!toast || !text) return;

    text.innerText = message;

    if (type === "error") toast.style.background = "#dc2626";   // red-600
    else if (type === "success") toast.style.background = "#16a34a"; // green-600
    else toast.style.background = "#1f2937"; // gray-800

    toast.classList.remove("hidden", "opacity-0", "translate-y-4");
    toast.classList.add("opacity-100", "translate-y-0");

    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(() => {
        toast.classList.add("opacity-0", "translate-y-4");
        setTimeout(() => toast.classList.add("hidden"), 300);
    }, 2000);
}

function openSignatureModal() {
    const modal = document.getElementById('modal-signature');
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    
    // åˆå§‹åŒ– Canvas
    canvas = document.getElementById('sig-canvas');
    ctx = canvas.getContext('2d');
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // âœ… åªç¶å®šä¸€æ¬¡äº‹ä»¶ï¼Œé¿å…è¶Šç•«è¶Šç²—
    if (!signatureInitialized) {
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', endDraw);
        canvas.addEventListener('touchstart', startDraw, {passive: false});
        canvas.addEventListener('touchmove', draw, {passive: false});
        canvas.addEventListener('touchend', endDraw);
        signatureInitialized = true;
    }
}

        function closeSignatureModal() {
            const modal = document.getElementById('modal-signature');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function resizeCanvas() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            // è¨­ç½®ç·šæ¢æ¨£å¼
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDraw(e) {
            e.preventDefault();
            isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        function draw(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function endDraw() {
            isDrawing = false;
        }

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

function saveSignature() {
    const preview = document.getElementById('signature-preview');
    const placeholder = document.getElementById('signature-placeholder');

    // åªè¨˜éŒ„ç°½åï¼Œä¸ä¸Šå‚³
    signatureDataUrl = canvas.toDataURL("image/png");

    preview.src = signatureDataUrl;
    preview.classList.remove('hidden');
    placeholder.classList.add('hidden');

    signatureTime = new Date();
    document.getElementById("signature-status").classList.remove("hidden");
    document.getElementById("signature-time").innerText =
        "ç°½ç½²æ™‚é–“ï¼š" + signatureTime.toLocaleString('zh-TW', {
            year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit', hour12: false
        });

    closeSignatureModal();
}

        // 5. å¥‘ç´„æ¢æ¬¾ Modal (ä¿æŒåŸæ¨£)
const TERMS_CONTENT = {
            grooming: `
                <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-4 mb-6 text-red-700 font-bold text-left text-xs animate-pulse">
                    âš ï¸ é£¼ä¸»æ‡‰ç›¡å‘ŠçŸ¥ç¾©å‹™ï¼Œè‹¥å› éš±çç—…æ³ç™¼ç”Ÿæ„å¤–æˆ–æ­»äº¡ï¼Œç¶“æ³•å®šç¨‹åºåˆ¤å®šåº—å®¶ç„¡ç–å¤±ï¼Œ<span class="underline">åº—å®¶ä¸é ˆè² æå®³è³ å„Ÿè²¬ä»»</span>ã€‚
                </div>
<div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6 text-amber-900 text-[12px] leading-relaxed text-left">
  <div class="flex items-center gap-2 font-bold text-amber-800 mb-2">
    <i data-lucide="badge-dollar-sign" class="w-4 h-4"></i>
    æ”¶è²»èˆ‡é¡å¤–è™•ç†è²»ç”¨
  </div>
  <p>æ”¶è²»ä¾é«”å‹æ¯›é‡ç¾å ´å ±åƒ¹ã€‚</p>
  <p>è‹¥ç™¼ç¾è·³èš¤ã€å£è¨ï¼Œå°‡æ”¶å–ç’°å¢ƒæ¸…æ½”è²» <b>NT$1,000</b>ã€‚</p>
  <p>æ‰“çµèˆ‡å»¢æ¯›è™•ç†è²»å¦è¨ˆï¼ˆæ‹†çµ <b>NT$200 èµ·</b>ã€å»¢æ¯› <b>NT$100 èµ·</b>ï¼‰ã€‚</p>
</div>
                <div class="space-y-4 text-left">
                    <p class="border-l-4 border-theme-primary pl-3 font-bold text-theme-text text-base italic">âœ‚ï¸ ç¾å®¹æœå‹™ ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</p>
                    
                    <p><strong>ç¬¬ä¸€æ¢ï¼ˆå¥‘ç´„ç›®çš„ï¼‰ï¼š</strong><br>æœ¬æœå‹™ç‚ºçŠ¬è²“ç¾å®¹æœå‹™ï¼Œ<span class="text-theme-dark">ä¸æ¶‰åŠä»»ä½•é†«ç™‚è¡Œç‚º</span>ã€‚</p>

                    <p><strong>ç¬¬äº”æ¢ï¼ˆå¥åº·å‘ŠçŸ¥ï¼‰ï¼š</strong><br>ç”²æ–¹æ‡‰èª å¯¦å‘ŠçŸ¥å¯µç‰©ç—…å²èˆ‡æ˜¯å¦å…·æœ‰æ”»æ“Šæ€§ã€‚<span class="text-red-600 font-black">è‹¥å› éš±çå°è‡´æ„å¤–ï¼Œä¹™æ–¹ä¸è² è²¬æå®³è³ å„Ÿè²¬ä»»</span>ï¼›è‹¥å› éš±çå°è‡´ä¹™æ–¹äººå“¡å‚·äº¡ã€è²¡æç­‰æå¤±ï¼Œ<span class="text-red-600 font-black underline">ä¹™æ–¹å°‡å…¨é¡å‘ç”²æ–¹æ±‚å„Ÿ</span>ã€‚</p>

                    <p><strong>ç¬¬ä¹æ¢ï¼ˆé€€è²»è¦å®šï¼‰ï¼š</strong><br>åŒ…æœˆæœå‹™ç”³è«‹çµ‚æ­¢æ™‚ï¼Œé æ”¶ç¸½é¡éœ€<span class="text-theme-dark font-bold">æ‰£é™¤ï¼ˆå·²ä½¿ç”¨æ¬¡æ•¸ X å–®æ¬¡åŸåƒ¹ï¼‰</span>å¾Œé€€é‚„é¤˜é¡ã€‚</p>

                    <p><strong>ç¬¬åäºŒæ¢ï¼ˆé€¾æ™‚æ¥å›ï¼‰ï¼š</strong><br>è‹¥æ–¼ç´„å®šæ™‚é–“å…§æœªé ˜å›ï¼Œå°‡åŠ æ”¶å®‰è¦ªè²»ï¼›<span class="text-theme-dark font-bold">è‹¥æ‰“çƒŠæ™‚ä»æœªæ¥å›ï¼Œå‰‡è¦–åŒä½å®¿ä¸€æ™šè¨ˆè²»</span>ã€‚å¦‚ç¶“é€šçŸ¥<span class="text-red-600 font-black underline">ä¸‰æ—¥å…§æœªé ˜å›ï¼Œå°‡ä¾ç…§å‹•ä¿æ³•ç¬¬29æ¢ç§»äº¤ä¸»ç®¡æ©Ÿé—œ</span>ã€‚</p>

                    <p><strong>ç¬¬åäº”æ¢ï¼ˆå±¥ç´„ä¿éšœï¼‰ï¼š</strong><br>é æ”¶è²»ç”¨ç´¯ç©é‡‘é¡æ–°å°å¹£ä¸€è¬å…ƒä»¥ä¸‹ï¼Œä¾æ³•å…æä¾›å±¥ç´„ä¿éšœã€‚</p>
                    
                    <div class="pt-4 border-t border-theme-sub/20 text-[10px] text-theme-sub space-y-1">
                        <p>â€» å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</p>
                        <p>â€» å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥<span class="font-bold">è‡ºä¸­åœ°æ–¹æ³•é™¢</span>ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</p>
                    </div>
                </div>
            `,
boarding: `
                <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-4 mb-6 text-red-700 font-bold text-center text-xs animate-pulse">
                    âš ï¸ é£¼ä¸»æ‡‰ç›¡å‘ŠçŸ¥ç¾©å‹™ï¼Œè‹¥å› éš±çç—…æ³ç™¼ç”Ÿæ„å¤–æˆ–æ­»äº¡ï¼Œç¶“æ³•å®šç¨‹åºåˆ¤å®šåº—å®¶ç„¡ç–å¤±ï¼Œ<span class="underline">åº—å®¶ä¸é ˆè² æå®³è³ å„Ÿè²¬ä»»</span>ã€‚
                </div>

                <div class="space-y-5 text-left text-[13px]">
                    <p class="border-l-4 border-theme-primary pl-3 font-bold text-theme-text text-base italic">ğŸ  ä½å®¿/å®‰è¦ª ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</p>
                    
                    <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 space-y-2">
                        <p class="text-amber-800 font-black flex items-center gap-1">
                            <i data-lucide="shield-alert" class="w-4 h-4"></i> é 24 å°æ™‚ç…§è­·è²æ˜ï¼š
                        </p>
                        <p class="text-amber-900 leading-relaxed">
                            æœ¬äººï¼ˆé£¼ä¸»ï¼‰å·²çŸ¥æ‚‰ä¸”åŒæ„ï¼Œ<span class="font-black underline">å¤§æŸ´å°ç†Šç„¡æä¾›å¤œé–“ç…§é¡§æœå‹™</span>ã€‚æ´»å‹•æ™‚é–“çµæŸå¾Œè‡³éš”æ—¥é–‹åº—å‰ï¼Œå¯µç‰©å°‡ç¨è™•æ–¼æˆ¿é–“å…§ã€‚è‹¥å¯µç‰©æ–¼å¤œé–“ç„¡äººæ™‚æ®µç™¼ç”Ÿçªç™¼ç‹€æ³ï¼ˆå¦‚æ€¥ç—…ã€ä¼‘å…‹ã€è‡ªèº«ç„¦æ…®é€ æˆä¹‹å‚·å®³ã€å˜”åç­‰ï¼‰ï¼Œåº—å®¶å¯èƒ½ç„¡æ³•å³æ™‚ç™¼ç¾æˆ–è™•ç½®ï¼Œ<span class="font-black">æœ¬äººé¡˜æ„æ‰¿æ“”æ­¤é¢¨éšªï¼Œä¸¦åŒæ„ä¸è¿½ç©¶åº—å®¶è²¬ä»»</span>ã€‚
                        </p>
                    </div>

                    <div class="space-y-3">
                        <p><strong>ä¸€ã€ä½å®¿è¨ˆè²»èˆ‡é€²é€€æˆ¿ï¼š</strong><br>æœ¬é¤¨ä½å®¿ä»¥ã€Œæ™šã€ç‚ºå–®ä½ã€‚å…¥ä½æ™‚é–“ 10:00-18:00ï¼Œé€€æˆ¿æ‡‰æ–¼ 18:00 å‰ã€‚é€¾æ™‚è¦å®šï¼š</p>
                        <ul class="list-disc pl-5 space-y-1 text-theme-dark font-bold">
                            <li>18:00 è‡³ 19:00 æ¥å›è€…ï¼šåŠ æ”¶ã€Œå®‰è¦ªè²»ç”¨ã€ã€‚</li>
                            <li>è¶…é 19:00 æœªæ¥å›è€…ï¼š<span class="text-red-600 underline">å‡è¦–åŒã€Œä½å®¿ä¸€æ™šã€</span>ï¼Œä¾ç¾å ´è²»ç‡è¨ˆè²»ã€‚</li>
                        </ul>
                    </div>

                    <p><strong>äºŒã€é£²é£Ÿèˆ‡å¥åº·ï¼š</strong><br>ä½å®¿æœŸé–“è«‹è‡ªå‚™é£¼æ–™ã€‚è‹¥ç”±åº—å…§æä¾›å°è‡´æ›é£Ÿè…¸èƒƒä¸é©ï¼ˆå¦‚è»Ÿä¾¿ã€è…¹ç€‰ï¼‰ï¼Œ<span class="text-theme-dark font-bold">æ—…é¤¨æ•ä¸è² è²¬è³ å„Ÿ</span>ã€‚</p>

                    <p><strong>ä¸‰ã€æ´—è­·è¦æ±‚ï¼š</strong><br>å…¥ä½ç•¶æ—¥éœ€å®Œæˆç¾å®¹éƒ¨æ´—è­·ï¼ˆè²»ç”¨å¦è¨ˆï¼‰ã€‚è‹¥ç™¼ç¾å¯„ç”ŸèŸ²ï¼Œå°‡<span class="text-red-600 font-black">é¡å¤–æ”¶å–é™¤èŸ²åŠç’°å¢ƒæ¸…æ½”è²»</span>ã€‚</p>

                    <p><strong>å››ã€éºæ£„èˆ‡æ³•å¾‹è²¬ä»»ï¼š</strong><br>é€¾æœŸä¸‰æ—¥è¯ç¹«ä¸ä¸Šé£¼ä¸»ï¼Œå°‡<span class="text-red-600 font-black underline">ä¾å‹•ä¿æ³•äº¤ä»˜å‹•ä¿è™•</span>ï¼Œè¡ç”Ÿè²»ç”¨ç”±é£¼ä¸»å…¨é¡æ”¯ä»˜ã€‚</p>

                    <p><strong>äº”ã€æ”»æ“Šèˆ‡æå®³è³ å„Ÿï¼š</strong><br>è‹¥éš±çæ”»æ“Šè¡Œç‚ºå°è‡´å‚·äº¡ï¼Œæœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿã€‚è‹¥åº—å…§ç‰©å“ï¼ˆæ”å½±æ©Ÿã€éš”é–“ç­‰ï¼‰é­ç ´å£ï¼Œ<span class="font-black">é£¼ä¸»é ˆå…¨é¡è³ å„Ÿ</span>ã€‚</p>

                    <p><strong>å…­ã€é†«ç™‚èˆ‡é¢¨éšªï¼š</strong><br>çªç™¼ç–¾ç—…é€é†«ä¹‹é†«ç™‚åŠäº¤é€šè²»ç”±é£¼ä¸»å…¨é¡è² æ“”ã€‚è‹¥éš±çç—…æ³æˆ–å…·é«˜é¢¨éšªç–¾ç—…ï¼ˆå¿ƒè‡Ÿç—…ã€ç™²ç™‡ç­‰ï¼‰ç™¼ç”Ÿæ„å¤–ï¼Œ<span class="text-red-600 font-black">ç¶“åˆ¤å®šæœ¬é¤¨ç„¡ç–å¤±å‰‡ä¸è² è²¬è³ å„Ÿ</span>ã€‚</p>

                    <div class="bg-gray-50 p-3 rounded-xl border border-gray-200">
                        <p><strong>ä¸ƒã€äººç‚ºç–å¤±è³ å„Ÿä¸Šé™ï¼š</strong><br>è‹¥å› äººç‚ºç–å¤±å°è‡´èµ°å¤±ã€å‚·äº¡ï¼Œæœ¬é¤¨ä¾æ³•è³ å„Ÿï¼Œ<span class="text-red-600 font-black underline text-sm">è³ å„Ÿä¸Šé™ç‚ºæ–°å°å¹£ 30,000 å…ƒæ•´</span>ï¼ˆç©è€å°å‚·ç—•é™¤å¤–ï¼‰ã€‚</p>
                    </div>

                    <p><strong>å…«ã€æ­»äº¡è™•ç†ï¼š</strong><br>å› å¹´è€æˆ–èˆŠç–¾æ­»äº¡ï¼Œè«‹æ–¼ <span class="font-bold">24 å°æ™‚å…§é ˜å›</span>ã€‚è‹¥éœ€é‘‘å®šæ­»å› è«‹æ–¼ 24 å°æ™‚å…§æœƒåŒè¾¦ç†ï¼Œé€¾æœŸä¸å¾—ç•°è­°ã€‚</p>

                    <p><strong>ä¹ã€æ•£æ­¥é¢¨éšªï¼š</strong><br>æ•£æ­¥æ™‚è‹¥å› å¯µç‰©<span class="font-bold">æ™è„«ç‰½ç¹©å°è‡´é€ƒè·‘æˆ–å‚·äº¡</span>ï¼Œæœ¬é¤¨ä¸è² è²¬ç›¸é—œè³ å„Ÿäº‹å®œã€‚</p>

                    <div class="pt-4 border-t border-theme-sub/20 text-[10px] text-theme-sub space-y-1">
                        <p>â€» å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</p>
                        <p>â€» å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥<span class="font-bold">è‡ºä¸­åœ°æ–¹æ³•é™¢</span>ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</p>
                    </div>
                </div>
            `
        };

function showTerms() {
    const modal = document.getElementById('modal-terms');
    const content = document.getElementById('modal-content');
    const body = document.getElementById('modal-body');
    const title = document.getElementById('modal-title');

    if (currentType === 'grooming') {
        title.innerText = "çŠ¬è²“ç¾å®¹å¥‘ç´„æ¢æ¬¾";
        body.innerHTML = TERMS_CONTENT.grooming;
    } else {
        title.innerText = "å¯µç‰©ä½å®¿å¥‘ç´„æ¢æ¬¾";
        body.innerHTML = TERMS_CONTENT.boarding;
    }

    // â­ æ¯æ¬¡æ‰“é–‹éƒ½é‡è¨­æŒ‰éˆ•ç‚ºé–å®š
    const btn = document.getElementById('agree-btn');
    const tip = document.getElementById('terms-scroll-tip');
    btn.disabled = true;
    btn.className = "w-full py-4 rounded-2xl font-bold shadow-glow transition-all active:scale-[0.98] tracking-[0.1em] bg-gray-200 text-gray-400 cursor-not-allowed";
    btn.innerText = "è«‹é–±è®€å®Œç•¢";
    tip.classList.remove('hidden');

    // â­ å·è»¸å›åˆ°æœ€ä¸Š
    setTimeout(() => {
        body.scrollTop = 0;
    }, 50);

    modal.classList.remove('hidden');
    setTimeout(() => {
        content.classList.remove('scale-95', 'opacity-0');
    }, 10);
}
        function closeTerms() {
            const modal = document.getElementById('modal-terms');
            const content = document.getElementById('modal-content');
            // åŠ å…¥ç¸®å°èˆ‡é€æ˜é¡åˆ¥
            content.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        let newWorker;

if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        // è¨»å†Š sw.js (æ ¹æ“šä½ çš„éœ€æ±‚ï¼Œindex ç”¨ sw.js)
        navigator.serviceWorker.register('sw.js?v=3').then(reg => {
            reg.addEventListener('updatefound', () => {
                newWorker = reg.installing;
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // é¡¯ç¤ºæ›´æ–°æç¤ºçª—
                        showUpdateToast();
                    }
                });
            });
        });
    });
}
let lastContractData = null;

function showSuccessPage(contractData, hasEmail) {
    lastContractData = contractData;

    document.getElementById("view-home").style.display = "none";
    document.getElementById("view-form").classList.add("hidden");
    document.getElementById("view-success").classList.remove("hidden");
    document.getElementById("navbar").classList.add("opacity-0", "pointer-events-none");

    const iconWrap = document.getElementById("success-icon-wrap");
    const icon = document.getElementById("success-icon");
    const title = document.getElementById("success-title");
    const box = document.getElementById("success-box");

    if (hasEmail) {
        title.innerText = "å¥‘ç´„å·²å¯„å‡ºï¼";
        iconWrap.className = "mx-auto w-20 h-20 rounded-full flex items-center justify-center bg-theme-primary/20";
        icon.setAttribute("data-lucide", "check");
        icon.className = "w-10 h-10 text-theme-dark";
        box.className = "rounded-2xl p-4 text-sm text-theme-text border border-theme-primary/30 bg-theme-bg/70 text-left";
        box.innerHTML = `
            <div class="flex items-center gap-2 font-bold mb-1 text-theme-dark">
              <i data-lucide="mail-check" class="w-4 h-4"></i> å‰¯æœ¬å·²å¯„å‡º
            </div>
            å¥‘ç´„å‰¯æœ¬å·²å¯„é€è‡³æ‚¨çš„ä¿¡ç®±ã€‚<br>
            å»ºè­°æ‚¨ä¹Ÿå¯é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œé–‹å•Ÿå®Œæ•´å¥‘ç´„æˆªåœ–å‚™ä»½ã€‚
        `;
    } else {
        title.innerText = "æäº¤æˆåŠŸï¼";
        iconWrap.className = "mx-auto w-20 h-20 rounded-full flex items-center justify-center bg-red-100";
        icon.setAttribute("data-lucide", "alert-circle");
        icon.className = "w-10 h-10 text-red-500";
        box.className = "rounded-2xl p-4 text-sm text-red-700 border border-red-200 bg-red-50 text-left";
        box.innerHTML = `
            <div class="flex items-center gap-2 font-bold mb-1">
              <i data-lucide="alert-triangle" class="w-4 h-4"></i> æœªå¡«å¯«ä¿¡ç®±
            </div>
            æ‚¨æœªå¡«å¯« Emailï¼Œç„¡æ³•æ”¶åˆ°é›»å­å‰¯æœ¬ã€‚<br>
            è«‹å‹™å¿…é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å•Ÿå¥‘ç´„ä¸¦æˆªåœ–ä¿å­˜ï¼
        `;
    }

    lucide.createIcons();
    window.scrollTo({ top: 0, behavior: "smooth" });
}

function backToHomeFromSuccess() {
    document.getElementById("view-success").classList.add("hidden");
    router('home');
}

function openSimpleContract() {
    if (!lastContractData) return;
    const html = generateContractHTML(lastContractData);
    const win = window.open("", "_blank");
    if (win) {
        win.document.write(html);
        win.document.close();
    } else {
        alert("å½ˆå‡ºè¦–çª—è¢«é˜»æ“‹ï¼Œè«‹å…è¨±é–‹å•Ÿè¦–çª—");
    }
}

function generateContractHTML(payload) {
    const { type, data, signature_url, pet_photo_url, vaccine_photo_url, created_at, signed_at } = payload;

const LOGO_URL = "https://vmjczgepqlefbsfarogk.supabase.co/storage/v1/object/public/logo/logo__2_-removebg-preview.png";

    const isBoarding = type === "boarding";
    const isDaycare = !!data.daycare_date;

    const formatList = (v) => Array.isArray(v) ? v.join("ã€") : (v || "ç„¡");

    function calcAge() {
        if (data.pet_age) return parseFloat(data.pet_age);
        if (data.pet_birthday) {
            const birth = new Date(data.pet_birthday);
            const now = new Date();
            return (now - birth) / (1000 * 60 * 60 * 24 * 365);
        }
        return 0;
    }
    const age = calcAge();
    const isHighRisk = (age >= 8) || (age > 0 && age < 0.42) || (data.history_check === "æœ‰ç—…å²");

    const signTime = signed_at || created_at;

    return `
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>å¤§æŸ´å°ç†Š - å¥‘ç´„å‰¯æœ¬</title>
<style>
body{font-family:"Noto Sans TC",sans-serif;background:#f5f9f6;color:#4a5d50;padding:24px;}
.container{max-width:900px;margin:auto;background:white;border-radius:24px;padding:32px;box-shadow:0 8px 32px rgba(74,93,80,0.08);border:1px solid #e1ebe4;}
.header{text-align:center;border-bottom:2px solid #A5C4AE;padding-bottom:18px;margin-bottom:24px;}
.logo{width:120px;margin-bottom:8px;}
h1{margin:0;font-size:22px;font-weight:800;letter-spacing:2px;}
.small{font-size:12px;color:#8C9E92;}
.section{margin-bottom:24px;}
.section-title{font-size:16px;font-weight:800;color:#4A5D50;border-left:4px solid #A5C4AE;padding-left:10px;margin-bottom:10px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:13px;}
.card{border:1px solid #dfe8e2;border-radius:16px;padding:16px;margin-bottom:12px;background:#fff;}
.tag{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:bold;background:#A5C4AE;color:white;}
.terms{background:#f9fbf9;border:1px solid #dfe8e2;border-radius:16px;padding:16px;font-size:12px;line-height:1.7;}
.vendor-card{
  background:#f9fbf9;
  border:1px solid #dfe8e2;
  border-radius:16px;
  padding:14px 18px;
  margin:0 auto 16px;
  max-width:620px;
  text-align:left;   /* âœ… å…§å®¹é å·¦ */
}
.vendor-title{
  font-size:11px;
  font-weight:700;
  letter-spacing:2px;
  color:#8C9E92;
  margin-bottom:10px;
}
.vendor-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px 18px;
  font-size:12px;
}
.vendor-item{
  text-align:left;
}
.vendor-item span.label{
  display:block;
  font-size:10px;
  color:#8C9E92;
}
.vendor-item span.value{
  display:block;
  font-weight:700;
  color:#4A5D50;
}
.vendor-full{
  grid-column:1 / -1;
}
.signature{margin-top:16px;text-align:center;}
.signature img{max-width:240px;border-bottom:2px solid #555;padding-bottom:6px;}
.highlight{color:#c53030;font-weight:bold;}
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <img src="${LOGO_URL}" class="logo">
    <h1>å¤§æŸ´å°ç†Šå¯µç‰©ç¾å®¹</h1>
    <div class="small">æ•¸ä½å¥‘ç´„å‰¯æœ¬</div>
  </div>

  <div class="section">
    <div class="section-title">é£¼ä¸»è³‡æ–™</div>
    <div class="grid">
      <div>å§“åï¼š${data.owner_name || "-"}</div>
      <div>é›»è©±ï¼š${data.phone || "-"}</div>
      <div>Emailï¼š${data.email || "-"}</div>
      <div>èº«åˆ†è­‰ï¼š${data.id_number || "-"}</div>
      <div>ç·Šæ€¥è¯çµ¡äººï¼š${data.emergency_contact || "-"}</div>
      <div>ç·Šæ€¥é›»è©±ï¼š${data.emergency_phone || "-"}</div>
    </div>
    <div class="small" style="margin-top:6px;">åœ°å€ï¼š${data.address || "-"}</div>
  </div>

  <div class="section">
    <div class="section-title">å¯µç‰©è³‡æ–™</div>
    <div class="grid">
      <div>ç¨®é¡ï¼š${data.pet_type || "-"}</div>
      <div>åå­—ï¼š${data.pet_name || "-"}</div>
      <div>å“ç¨®ï¼š${data.pet_breed || "-"}</div>
      <div>é«”é‡ï¼š${data.pet_weight || "-"} kg</div>
      <div>å¹´é½¡ï¼š${data.pet_age || "-"}</div>
      <div>ç”Ÿæ—¥ï¼š${data.pet_birthday || "-"}</div>
      <div>æ€§åˆ¥ï¼š${data.gender || "-"}</div>
      <div>çµç´®ï¼š${data.neuter || "-"}</div>
      <div>æ™¶ç‰‡ï¼š${data.microchip_status || "-"}</div>
      <div>æ™¶ç‰‡è™Ÿç¢¼ï¼š${data.microchip_number || "-"}</div>
      <div>æ”»æ“Šæ€§ï¼š${data.aggression || "-"}</div>
      <div>èˆ‡ç‹—ç›¸è™•ï¼š${data.dog_social || "-"}</div>
      <div>æ€§æƒ…è©•ä¼°ï¼š${data.temperament || "-"}</div>
      <div>ç—…å²ï¼š${data.history_check || "-"}</div>
    </div>
    <div class="small" style="margin-top:6px;">ç—…å²è©³è¿°ï¼š${data.history_detail || "ç„¡"}<br>æŒ‡å®šé†«é™¢ï¼š${data.specified_hospital || "ä¾åº—å®¶æŒ‡å®š"}</div>
  </div>

  <div class="section">
    <div class="section-title">æœå‹™é¡å‹</div>
    <span class="tag">${isBoarding ? (isDaycare ? "å®‰è¦ª" : "ä½å®¿") : "ç¾å®¹"}</span>
  </div>

  ${type === "grooming" ? `
  <div class="section card">
    <b>ç¾å®¹å…§å®¹</b><br>
    åŸºæœ¬æœå‹™ï¼š${formatList(data.service)}<br>
    å‡ç´šæœå‹™ï¼š${formatList(data.upgrade_service)}<br>
    å…¶ä»–éœ€æ±‚ï¼š${data.other_service_text || "ç„¡"}<br>
    æ‰“çµè™•ç†ï¼š${data.matting_suspected ? "æœ‰" : "ç„¡"}<br>
æ‰“çµæ–¹æ¡ˆï¼š${
  data.matting_choice === "æ–¹æ¡ˆä¸€" 
    ? "æ–¹æ¡ˆä¸€ï½œæ‹†çµè™•ç†ï¼ˆå¦å¤–è¨ˆè²»ï¼‰" 
    : data.matting_choice === "æ–¹æ¡ˆäºŒ" 
      ? "æ–¹æ¡ˆäºŒï½œä¸æ‹†çµï¼Œç›´æ¥ä¿®å‰ª" 
      : "ç„¡"
}<br>
  </div>
  ` : ""}

  ${type === "boarding" ? `
  <div class="section card">
    <b>ä½å®¿/å®‰è¦ªå…§å®¹</b><br>
    å…¥ä½æ—¥æœŸï¼š${data.checkin_date || "-"}<br>
    é€€æˆ¿æ—¥æœŸï¼š${data.checkout_date || "-"}<br>
    å®‰è¦ªæ—¥æœŸï¼š${data.daycare_date || "-"}<br>
    æŠµé”æ™‚é–“ï¼š${data.arrive_time || "-"}<br>
    æ¥å›æ™‚é–“ï¼š${data.leave_time || "-"}<br>
    é©…èŸ²ç‹€æ³ï¼š${data.deworming || "-"}<br>
    é©…èŸ²ç‰Œå­ï¼š${data.deworming_brand || "-"}<br>
    æ˜¯å¦å å«ï¼š${data.barking || "-"}<br>
    å å«å‚™è¨»ï¼š${data.barking_note || "-"}<br>
    æ˜¯å¦è­·é£Ÿï¼š${data.food_guard || "-"}<br>
    è­·é£Ÿå‚™è¨»ï¼š${data.food_guard_note || "-"}<br>
    æ˜¯å¦ä½¿ç”¨å°¿å¸ƒå¢Šï¼š${data.toilet || "-"}<br>
    å»æ‰€å‚™è¨»ï¼š${data.toilet_note || "-"}<br>
    ç–«è‹—ç‹€æ…‹ï¼š${data.vaccine || "-"}<br>
    å‚™è¨»ï¼š${data.boarding_note || "ç„¡"}<br>
  </div>
  ` : ""}

  <div class="section">
    <div class="section-title">é™„ä»¶</div>
    <div class="small">å¯µç‰©ç…§ç‰‡ï¼š${pet_photo_url ? `<a href="${pet_photo_url}" target="_blank">æª¢è¦–</a>` : "ç„¡"}</div>
    <div class="small">ç–«è‹—æ‰‹å†Šï¼š${vaccine_photo_url ? `<a href="${vaccine_photo_url}" target="_blank">æª¢è¦–</a>` : "ç„¡"}</div>
  </div>

  <div class="section">
    <div class="section-title">å®Œæ•´æ¢æ¬¾</div>
    <div class="terms">
      ${type === "grooming" ? TERMS_CONTENT.grooming : ""}
      ${type === "boarding" ? TERMS_CONTENT.boarding : ""}
${isHighRisk ? `
  <div style="margin-top:16px;padding:12px;border:2px solid #e53e3e;border-radius:12px;background:#fff5f5;line-height:1.7;">
    <b class="highlight">âš  é«˜é¢¨éšªå¯µç‰©ç‰¹åˆ¥æ¢æ¬¾</b><br>
    1. æœ¬äººå·²çŸ¥æ‚‰é«˜é½¡ã€å¹¼é½¡ã€æˆ–æ‚£æœ‰æ…¢æ€§ç–¾ç—…ï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€å‘¼å¸é“ç–¾ç—…ç­‰ï¼‰ä¹‹å¯µç‰©ï¼Œ
    åœ¨ç¾å®¹ï¼ä½å®¿éç¨‹ä¸­å¯èƒ½å› ç’°å¢ƒç·Šè¿«ã€æƒ…ç·’ç·Šå¼µæˆ–èº«é«”ç‹€æ³ä¸ä½³è€Œç™¼ç”Ÿçªç™¼ç‹€æ³ã€‚<br>
    2. è‹¥å¯µç‰©æ–¼æœå‹™æœŸé–“çªç™¼ä¸é©ï¼Œä¹™æ–¹å¾—ä¾ç‹€æ³ç·Šæ€¥é€é†«è™•ç½®ï¼Œç›¸é—œé†«ç™‚åŠäº¤é€šè²»ç”¨ç”±ç”²æ–¹å…¨é¡è² æ“”ã€‚<br>
    3. è‹¥ç¶“åˆ¤å®šä¹™æ–¹ç„¡ç–å¤±ï¼Œç”²æ–¹åŒæ„ä¸å°ä¹™æ–¹æå‡ºä»»ä½•æå®³è³ å„Ÿæˆ–æ³•å¾‹è¿½è¨´ã€‚
  </div>` : ""}
    </div>
  </div>

  <div class="section signature">

    <div class="vendor-card">
      <div class="vendor-title">ä¹™æ–¹ï¼ˆåº—å®¶ï¼‰è³‡è¨Š</div>
      <div class="vendor-grid">
        <div class="vendor-item">
          <span class="label">åº—å®¶åç¨±</span>
          <span class="value">å¤§æŸ´å°ç†Šå¯µç‰©ç¾å®¹</span>
        </div>
        <div class="vendor-item">
          <span class="label">è² è²¬äºº</span>
          <span class="value">é™³äºçª</span>
        </div>
        <div class="vendor-item">
          <span class="label">ç‰¹å¯µæ¥­å­—è™Ÿ</span>
          <span class="value">S1130033 è™Ÿ</span>
        </div>
        <div class="vendor-item">
          <span class="label">çµ±ä¸€ç·¨è™Ÿ</span>
          <span class="value">94536765</span>
        </div>
        <div class="vendor-item">
          <span class="label">è¯çµ¡é›»è©±</span>
          <span class="value">0981-681-349</span>
        </div>
        <div class="vendor-item">
          <span class="label">ç‡Ÿæ¥­æ™‚é–“</span>
          <span class="value">10:00â€“19:00</span>
        </div>
        <div class="vendor-item vendor-full">
          <span class="label">ç‡Ÿæ¥­åœ°å€</span>
          <span class="value">è‡ºä¸­å¸‚åŒ—å±¯å€å¹³å¾·è·¯82å··5è™Ÿ</span>
        </div>
      </div>
    </div>

    <div class="small">ç”²æ–¹ï¼ˆé£¼ä¸»ï¼‰æ•¸ä½ç°½ç½²</div>
    ${signature_url ? `<img src="${signature_url}">` : ""}

    <div class="small" style="margin-top:8px;color:#8C9E92;">
      ç°½ç½²æ™‚é–“ï¼š${new Date(signTime).toLocaleString("zh-TW")}
    </div>
  </div>

</div>
</body>
</html>
`;
}

function checkTermsScroll(el) {
    const reachedBottom = el.scrollHeight - el.scrollTop - el.clientHeight < 20;
    if (reachedBottom) {
        const btn = document.getElementById('agree-btn');
        const tip = document.getElementById('terms-scroll-tip');
        btn.disabled = false;
        btn.className = "w-full py-4 bg-gradient-lux text-white rounded-2xl font-bold shadow-glow hover:shadow-lg transition-all active:scale-[0.98] tracking-[0.1em]";
        btn.innerText = "æˆ‘å·²é–±è®€ä¸¦åŒæ„";
        tip.classList.add('hidden');
    }
}
function showUpdateToast() {
    const toast = document.getElementById('pwa-update-toast');
    toast.classList.remove('translate-y-32', 'opacity-0', 'pointer-events-none');
    lucide.createIcons(); // é‡æ–°æ¸²æŸ“åœ–æ¨™
}

function dismissUpdate() {
    const toast = document.getElementById('pwa-update-toast');
    toast.classList.add('translate-y-32', 'opacity-0', 'pointer-events-none');
}

function applyUpdate() {
    if (newWorker) {
        newWorker.postMessage('SKIP_WAITING');
    }
    // ç›£è½ controllerchangeï¼Œç•¶æ–°çš„ SW æ¥ç®¡å¾Œé‡æ•´é é¢
    navigator.serviceWorker.addEventListener('controllerchange', () => {
        window.location.reload();
    });
}

    </script>
    <div id="pwa-update-toast" class="fixed bottom-6 left-6 right-6 md:left-auto md:right-8 md:w-80 z-[1000] transform translate-y-32 opacity-0 transition-all duration-500 pointer-events-none">
    <div class="glass-panel p-5 rounded-[24px] border border-theme-primary/30 shadow-2xl flex flex-col gap-4">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-theme-primary/20 flex items-center justify-center text-theme-primary">
                <i data-lucide="sparkles" class="w-5 h-5"></i>
            </div>
            <div>
                <p class="text-sm font-bold text-theme-text">ç™¼ç¾æ–°ç‰ˆæœ¬å…§å®¹</p>
                <p class="text-[10px] text-theme-sub">é»æ“Šæ›´æ–°ä»¥ç²å–æœ€æ–°åŠŸèƒ½</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="dismissUpdate()" class="flex-1 py-2 text-xs font-bold text-theme-sub hover:bg-gray-100 rounded-xl transition">
                ç¨å¾Œå†èªª
            </button>
            <button onclick="applyUpdate()" class="flex-[2] py-2 bg-gradient-lux text-white text-xs font-bold rounded-xl shadow-lg shadow-theme-primary/30">
                ç«‹å³æ›´æ–°
            </button>
        </div>
    </div>
</div>
<!-- STEP1: é¸æ¯›å­© -->
<div id="old-modal-1" class="fixed inset-0 z-[300] hidden items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="bg-white rounded-2xl p-6 w-[90%] max-w-md shadow-xl">
    <h3 class="font-bold text-lg text-theme-text mb-1">ğŸ‰ æ­¡è¿å›ä¾†ï¼</h3>
    <p class="text-xs text-theme-sub mb-4">è«‹é¸æ“‡è¦å¸¶å…¥çš„æ¯›å­©ï¼š</p>

    <button onclick="applyOwnerOnly()" class="w-full mb-3 px-4 py-3 rounded-xl bg-theme-bg border border-theme-primary/30 text-sm font-bold flex items-center justify-center gap-2">
      ğŸ‘¤ åƒ…å¡«å…¥é£¼ä¸»è³‡æ–™ï¼ˆä¸å¸¶å…¥æ¯›å­©ï¼‰
    </button>

    <div id="old-pet-list" class="space-y-2 max-h-[50vh] overflow-y-auto"></div>
    <button onclick="closeOldModal()" class="mt-4 w-full py-2 rounded-xl bg-gray-100 text-sm font-bold">å–æ¶ˆæœå°‹</button>
  </div>
</div>

<!-- STEP2: é¸å¸¶å…¥é¡å‹ -->
<div id="old-modal-2" class="fixed inset-0 z-[310] hidden items-center justify-center bg-black/40 backdrop-blur-sm">
  <div class="bg-white rounded-2xl p-6 w-[90%] max-w-md shadow-xl">
    <h3 id="old-modal-title" class="font-bold text-lg text-theme-text mb-1">é¸æ“‡ç´€éŒ„</h3>
    <p class="text-xs text-theme-sub mb-4">è«‹é¸æ“‡è¦å¸¶å…¥å“ªä¸€ç¨®æœå‹™è³‡æ–™ï¼š</p>
    <div id="old-record-list" class="space-y-3"></div>
    <button onclick="closeOldModal()" class="mt-4 w-full py-2 rounded-xl bg-gray-100 text-sm font-bold">å–æ¶ˆæœå°‹</button>
  </div>
</div>
<!-- âœ… Toast æç¤º -->
<div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 z-[9999] hidden opacity-0 translate-y-4 transition-all duration-300 px-4 py-3 rounded-xl shadow-lg text-sm font-bold text-white"
     style="background:#1f2937;">
  <span id="toast-text">æç¤ºè¨Šæ¯</span>
</div>
</body>
</html>
